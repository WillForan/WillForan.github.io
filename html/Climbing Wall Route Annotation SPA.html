<!DOCTYPE html>
<html>
<head>
<title>Climbing Wall Route Annotation SPA</title>
<!-- 2017-12-09 Sat 16:27 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body class="container">
<div id="content">
<h1 class="title">Climbing Wall Route Annotation SPA</h1>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">What</h2>
<div class="outline-text-2" id="text-1">
<p>
 The Climbing Wall (TCW) has routes densily packed through different areas.
To track our effort, we 1) identify the route and 2) annotate our progress.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">identify</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Some routes have names. Most routes have the setter's initials. All routes have a color and grading (VB-V9).
Colors are repeated in different areas and occasionally within in an area, but the combined area, color, and difficulty should uniquely identify each route.
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">annotate</h3>
<div class="outline-text-3" id="text-1-2">
<p>
We might care about
</p>
<ul class="org-ul">
<li>fun factor (e.g. stars)
</li>
<li>precieved difficultly (within grade): easy,expected,hard
</li>
<li>flashed/onsite, completed, in-progress (% done?), skipped
</li>
<li>last attempt (day + % complete)
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">limitation's of org-mode tangle</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>line number error messages mean nothing
</li>
<li>quick edits are hard, collaboration is near impossible
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Code</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">The html for the SPA only calls javascript (which among other things, inserts the svg</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">

<pre class="src src-html">&lt;<span style="font-weight: bold;">html</span>&gt;
&lt;<span style="font-weight: bold;">head</span>&gt;
&lt;<span style="font-weight: bold;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;"> TCW Route Tracker </span>&lt;/<span style="font-weight: bold;">title</span>&gt;
<span style="font-weight: bold; font-style: italic;">&lt;!--</span>
<span style="font-weight: bold; font-style: italic;"> &lt;script src="https://unpkg.com/vue"&gt;&lt;/script&gt;</span>
<span style="font-weight: bold; font-style: italic;"> &lt;script src="https://d3js.org/d3.v4.min.js"&gt;&lt;/script&gt;</span>
<span style="font-weight: bold; font-style: italic;">--&gt;</span>
&lt;<span style="font-weight: bold;">script</span> <span style="font-weight: bold; font-style: italic;">src</span>=<span style="font-style: italic;">"vue"</span>&gt;&lt;/<span style="font-weight: bold;">script</span>&gt;
&lt;<span style="font-weight: bold;">script</span> <span style="font-weight: bold; font-style: italic;">src</span>=<span style="font-style: italic;">"d3.v4.min.js"</span>&gt;&lt;/<span style="font-weight: bold;">script</span>&gt;
&lt;<span style="font-weight: bold;">link</span> <span style="font-weight: bold; font-style: italic;">rel</span>=<span style="font-style: italic;">"stylesheet"</span> <span style="font-weight: bold; font-style: italic;">href</span>=<span style="font-style: italic;">"style.css"</span>&gt; &lt;/<span style="font-weight: bold;">style</span>&gt;
&lt;/<span style="font-weight: bold;">head</span>&gt;
&lt;<span style="font-weight: bold;">body</span>&gt; 
<span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">vue </span><span style="font-weight: bold; font-style: italic;">--&gt;</span>
&lt;<span style="font-weight: bold;">div</span> <span style="font-weight: bold; font-style: italic;">id</span>=<span style="font-style: italic;">"climbing_spa"</span>&gt;
  &lt;<span style="font-weight: bold;">div</span> <span style="font-weight: bold; font-style: italic;">id</span>=<span style="font-style: italic;">"who-are-we"</span>&gt;
  logging as {{current.climber}} &lt;<span style="font-weight: bold;">span</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"clickable"</span> <span style="font-weight: bold;">v-on</span>:<span style="font-weight: bold; font-style: italic;">click</span>=<span style="font-style: italic;">"setClimber(null)"</span>&gt;change&lt;/<span style="font-weight: bold;">span</span>&gt;
  &lt;/<span style="font-weight: bold;">div</span>&gt;
  &lt;<span style="font-weight: bold;">div</span> <span style="font-weight: bold; font-style: italic;">id</span>=<span style="font-style: italic;">"route_specification"</span>&gt;

  <span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">to submit: route status and specific info </span><span style="font-weight: bold; font-style: italic;">--&gt;</span> 
    &lt;<span style="font-weight: bold;">span</span> <span style="font-weight: bold;">v-on</span>:<span style="font-weight: bold; font-style: italic;">click</span>=<span style="font-style: italic;">"reset_current()"</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"clickable"</span> <span style="font-weight: bold; font-style: italic;">v-show</span>=<span style="font-style: italic;">"have_any_current"</span>&gt; x &lt;/<span style="font-weight: bold;">span</span>&gt;
    <span style="font-weight: bold; font-style: italic;">&lt;!--  </span><span style="font-weight: bold; font-style: italic;">debug v-if displays</span>
<span style="font-weight: bold; font-style: italic;">    all: {{have_all_current}} &lt;br&gt;</span>
<span style="font-weight: bold; font-style: italic;">    any: {{have_any_current}} &lt;br&gt;</span>
<span style="font-weight: bold; font-style: italic;">    {{current.area  != null }} {{current.color != null }} {{current_grade != null}}</span>
<span style="font-weight: bold; font-style: italic;">    &lt;br&gt; current_grade: {{ current_grade }} | {{current.grade_full}} + {{current.plus_half}}</span>
<span style="font-weight: bold; font-style: italic;">     </span><span style="font-weight: bold; font-style: italic;">--&gt;</span>

    &lt;<span style="font-weight: bold;">div</span> <span style="font-weight: bold; font-style: italic;">id</span>=<span style="font-style: italic;">"current"</span> <span style="font-weight: bold; font-style: italic;">v-show</span>=<span style="font-style: italic;">"have_all_current"</span>&gt;
     &lt;<span style="font-weight: bold;">span</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"route_id"</span>&gt; 
      {{current.color}} {{grade_combined()}} on {{current.area}} 
     &lt;/<span style="font-weight: bold;">span</span>&gt;
     &lt;<span style="font-weight: bold;">br</span> /&gt;

     &lt;<span style="font-weight: bold;">select</span> <span style="font-weight: bold; font-style: italic;">v-model</span>=<span style="font-style: italic;">"current.status"</span> &gt;
      &lt;<span style="font-weight: bold;">option</span> <span style="font-weight: bold; font-style: italic;">value</span>=<span style="font-style: italic;">""</span> disabled selected&gt;status&lt;/<span style="font-weight: bold;">option</span>&gt;
      &lt;<span style="font-weight: bold;">option</span> <span style="font-weight: bold; font-style: italic;">v-for</span>=<span style="font-style: italic;">"s in options.status"</span> &gt;{{s}}&lt;/<span style="font-weight: bold;">option</span>&gt;
     &lt;/<span style="font-weight: bold;">select</span>&gt;

     &lt;<span style="font-weight: bold;">select</span> <span style="font-weight: bold; font-style: italic;">v-model</span>=<span style="font-style: italic;">"current.rate"</span> &gt;
      &lt;<span style="font-weight: bold;">option</span> <span style="font-weight: bold; font-style: italic;">value</span>=<span style="font-style: italic;">""</span> disabled selected&gt;rate&lt;/<span style="font-weight: bold;">option</span>&gt;
      &lt;<span style="font-weight: bold;">option</span> <span style="font-weight: bold; font-style: italic;">v-for</span>=<span style="font-style: italic;">"r in options.ratings"</span>&gt;{{r}}&lt;/<span style="font-weight: bold;">option</span>&gt;
     &lt;/<span style="font-weight: bold;">select</span>&gt;

     &lt;<span style="font-weight: bold;">input</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"text"</span> <span style="font-weight: bold; font-style: italic;">placeholder</span>=<span style="font-style: italic;">"notes"</span> <span style="font-weight: bold; font-style: italic;">v-model</span>=<span style="font-style: italic;">"current.note"</span> /&gt;
     &lt;<span style="font-weight: bold;">br</span> /&gt;
     &lt;<span style="font-weight: bold;">input</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"text"</span> <span style="font-weight: bold; font-style: italic;">placeholder</span>=<span style="font-style: italic;">"setter"</span> <span style="font-weight: bold; font-style: italic;">v-model</span>=<span style="font-style: italic;">"current.setter"</span> size=3 /&gt;
     &lt;<span style="font-weight: bold;">input</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"text"</span> <span style="font-weight: bold; font-style: italic;">placeholder</span>=<span style="font-style: italic;">"00/00"</span> <span style="font-weight: bold; font-style: italic;">v-model</span>=<span style="font-style: italic;">"current.set_date"</span> size=5 /&gt;
     &lt;<span style="font-weight: bold;">input</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"text"</span> <span style="font-weight: bold; font-style: italic;">placeholder</span>=<span style="font-style: italic;">"name"</span> <span style="font-weight: bold; font-style: italic;">v-model</span>=<span style="font-style: italic;">"current.name"</span> /&gt;


     &lt;/<span style="font-weight: bold;">br</span>&gt;
     &lt;<span style="font-weight: bold;">button</span> <span style="font-weight: bold;">v-on</span>:<span style="font-weight: bold; font-style: italic;">click</span>=<span style="font-style: italic;">"addCurrent()"</span> <span style="font-weight: bold; font-style: italic;">v-show</span>=<span style="font-style: italic;">"current.status"</span>&gt;Add&lt;/<span style="font-weight: bold;">button</span>&gt;
    &lt;/<span style="font-weight: bold;">div</span>&gt;

   <span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">3 piece identification </span><span style="font-weight: bold; font-style: italic;">--&gt;</span> 

   &lt;<span style="font-weight: bold;">div</span> <span style="font-weight: bold; font-style: italic;">id</span>=<span style="font-style: italic;">"id-current"</span>&gt;
    &lt;<span style="font-weight: bold;">select</span> <span style="font-weight: bold; font-style: italic;">v-model</span>=<span style="font-style: italic;">"current.color"</span> &gt;
        &lt;<span style="font-weight: bold;">option</span> <span style="font-weight: bold; font-style: italic;">value</span>=<span style="font-style: italic;">""</span> disabled selected&gt;color&lt;/<span style="font-weight: bold;">option</span>&gt;
        &lt;<span style="font-weight: bold;">option</span> <span style="font-weight: bold; font-style: italic;">v-for</span>=<span style="font-style: italic;">"g in options.color"</span> <span style="font-weight: bold;">v-bind</span>:<span style="font-weight: bold; font-style: italic;">style</span>=<span style="font-style: italic;">"{color: g}"</span>&gt;{{g}}&lt;/<span style="font-weight: bold;">option</span>&gt;
    &lt;/<span style="font-weight: bold;">select</span>&gt;

    &lt;<span style="font-weight: bold;">select</span> <span style="font-weight: bold; font-style: italic;">v-model</span>=<span style="font-style: italic;">"current.grade_full"</span> &gt;
        &lt;<span style="font-weight: bold;">option</span> <span style="font-weight: bold; font-style: italic;">value</span>=<span style="font-style: italic;">""</span> disabled selected&gt;grade&lt;/<span style="font-weight: bold;">option</span>&gt;
        &lt;<span style="font-weight: bold;">option</span> <span style="font-weight: bold; font-style: italic;">v-for</span>=<span style="font-style: italic;">"g in options.grade"</span>&gt;{{g}}&lt;/<span style="font-weight: bold;">option</span>&gt;
    &lt;/<span style="font-weight: bold;">select</span>&gt;

    &lt;<span style="font-weight: bold;">input</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"checkbox"</span> <span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">"plus_half"</span> <span style="font-weight: bold; font-style: italic;">v-model</span>=<span style="font-style: italic;">"current.plus_half"</span> /&gt; +1/2?
   &lt;/<span style="font-weight: bold;">div</span>&gt;


   <span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">"fancier" select</span>
<span style="font-weight: bold; font-style: italic;">     -- select grade as as radio buttons</span>

<span style="font-weight: bold; font-style: italic;">   &lt;ul class="color-buttons"&gt;</span>
<span style="font-weight: bold; font-style: italic;">     &lt;li v-for="c in options.color" v-bind:class="{'box-selected': c == current.color }" v-bind:style="{ background: c}" @click="current.color = c" v-bind:title="c" &gt;</span>
<span style="font-weight: bold; font-style: italic;">     &lt;/li&gt;</span>
<span style="font-weight: bold; font-style: italic;">   &lt;/ul&gt;</span>

<span style="font-weight: bold; font-style: italic;">   &lt;ul class="grade-select"&gt;</span>
<span style="font-weight: bold; font-style: italic;">    &lt;li v-for="g in options.grade"&gt;</span>
<span style="font-weight: bold; font-style: italic;">      &lt;input type="radio" name="grade" :value="g" v-model="current.grade_full" /&gt;&lt;br/&gt;</span>
<span style="font-weight: bold; font-style: italic;">     {{g}} </span>
<span style="font-weight: bold; font-style: italic;">      &lt;/li&gt;</span>
<span style="font-weight: bold; font-style: italic;">    &lt;li&gt;&lt;input type="checkbox" name="plus_half" v-model="current.plus_half" /&gt; &lt;br /&gt; +1/2?&lt;/li&gt;</span>
<span style="font-weight: bold; font-style: italic;">   &lt;/ul&gt;</span>
<span style="font-weight: bold; font-style: italic;">   </span><span style="font-weight: bold; font-style: italic;">--&gt;</span>

  &lt;<span style="font-weight: bold;">div</span> <span style="font-weight: bold; font-style: italic;">id</span>=<span style="font-style: italic;">"climbingAreas"</span>&gt; &lt;/<span style="font-weight: bold;">div</span>&gt;

  &lt;/<span style="font-weight: bold;">div</span>&gt;

  &lt;<span style="font-weight: bold;">div</span> <span style="font-weight: bold; font-style: italic;">id</span>=<span style="font-style: italic;">"list"</span>&gt;

   <span style="font-weight: bold; font-style: italic;">&lt;!--  </span><span style="font-weight: bold; font-style: italic;">summary list </span><span style="font-weight: bold; font-style: italic;">--&gt;</span>
   &lt;<span style="font-weight: bold;">ul</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"route_list"</span>&gt; 
     &lt;<span style="font-weight: bold;">li</span> <span style="font-weight: bold; font-style: italic;">v-for</span>=<span style="font-style: italic;">"r in route_summaries"</span>  <span style="font-weight: bold; font-style: italic;">v-if</span>=<span style="font-style: italic;">"matches_current(r)"</span>&gt; 
       &lt;<span style="font-weight: bold;">span</span> <span style="font-weight: bold;">v-on</span>:<span style="font-weight: bold; font-style: italic;">click</span>=<span style="font-style: italic;">"setCurrent(r)"</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"info"</span>&gt;
        {{r.area}} {{r.color}} {{r.grade}} 
       &lt;/<span style="font-weight: bold;">span</span>&gt; 
       &lt;<span style="font-weight: bold;">br</span> /&gt;
       &lt;<span style="font-weight: bold;">span</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"info_minor"</span>&gt;
        {{r.name}} {{r.setter}} {{r.set_date}}
       &lt;/<span style="font-weight: bold;">span</span>&gt;
       &lt;<span style="font-weight: bold;">span</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"stats"</span>&gt; 
        | {{r.cnt}} {{r.avgrank}} ( {{r.recent}} )
       &lt;/<span style="font-weight: bold;">span</span>&gt;
    &lt;/<span style="font-weight: bold;">li</span>&gt;
   &lt;/<span style="font-weight: bold;">ul</span>&gt;

   &lt;<span style="font-weight: bold;">hr</span> <span style="font-weight: bold; font-style: italic;">v-show</span>=<span style="font-style: italic;">"allroutes.length &gt; 0"</span>&gt;
   <span style="font-weight: bold; font-style: italic;">&lt;!--  </span><span style="font-weight: bold; font-style: italic;">raw list </span><span style="font-weight: bold; font-style: italic;">--&gt;</span>
   &lt;<span style="font-weight: bold;">ul</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"route_list"</span>&gt; 
     &lt;<span style="font-weight: bold;">li</span> <span style="font-weight: bold; font-style: italic;">v-for</span>=<span style="font-style: italic;">"r in allroutes"</span>&gt; 
       &lt;<span style="font-weight: bold;">span</span> <span style="font-weight: bold;">v-on</span>:<span style="font-weight: bold; font-style: italic;">click</span>=<span style="font-style: italic;">"setCurrent(r)"</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"info"</span>&gt;
        {{r.area}} {{r.color}} {{r.grade}} 
       &lt;/<span style="font-weight: bold;">span</span>&gt;  &lt;<span style="font-weight: bold;">br</span>&gt;
       &lt;<span style="font-weight: bold;">span</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"person"</span>&gt; 
        {{r.climber}} {{r.status}} @ {{r.timestamp}}
       &lt;/<span style="font-weight: bold;">span</span>&gt;
    &lt;/<span style="font-weight: bold;">li</span>&gt;
   &lt;/<span style="font-weight: bold;">ul</span>&gt;

  &lt;/<span style="font-weight: bold;">div</span>&gt;
&lt;/<span style="font-weight: bold;">div</span>&gt;



<span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">d3 select area </span><span style="font-weight: bold; font-style: italic;">--&gt;</span>
&lt;<span style="font-weight: bold;">script</span> <span style="font-weight: bold; font-style: italic;">src</span>=<span style="font-style: italic;">"climbarea.js"</span>&gt; &lt;/<span style="font-weight: bold;">script</span>&gt;
&lt;/<span style="font-weight: bold;">body</span>&gt;
&lt;/<span style="font-weight: bold;">html</span>&gt;
</pre>
</div>
</div>


<div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1">style</h4>
<div class="outline-text-4" id="text-2-1-1">
<div class="org-src-container">

<pre class="src src-css"><span style="font-weight: bold;">.clickable </span>{ <span style="font-weight: bold; font-style: italic;">cursor</span>: pointer;  }
<span style="font-weight: bold;">#current </span>{ <span style="font-weight: bold; font-style: italic;">border</span>: solid black 1px; <span style="font-weight: bold; font-style: italic;">padding</span>: 5px;}
<span style="font-weight: bold;">#id-current </span>{<span style="font-weight: bold; font-style: italic;">padding</span>: 1em}
<span style="font-weight: bold; font-style: italic;">/* </span><span style="font-weight: bold; font-style: italic;">ul/li setting for color buttons is the only real meaningful css setting </span>
<span style="font-weight: bold; font-style: italic;"> * all other elements will display in a functioning way with css </span><span style="font-weight: bold; font-style: italic;">*/</span>
<span style="font-weight: bold;">ul </span>{ 
 <span style="font-weight: bold; font-style: italic;">list-style</span>: none;
}

<span style="font-weight: bold;">.grade-select &gt;li </span>{ <span style="font-weight: bold; font-style: italic;">display</span>: inline-block; <span style="font-weight: bold; font-style: italic;">text-align</span>:center}
<span style="font-weight: bold;">.color-buttons&gt;li </span>{ 
  <span style="font-weight: bold; font-style: italic;">display</span>: inline-block;
  <span style="font-weight: bold; font-style: italic;">width</span>: 20px;
  <span style="font-weight: bold; font-style: italic;">height</span>:20px;
  <span style="font-weight: bold; font-style: italic;">margin-right</span>: 10;
  <span style="font-weight: bold; font-style: italic;">border</span>: solid black 2px;
  <span style="font-weight: bold; font-style: italic;">cursor</span>: pointer; }
<span style="font-weight: bold;">.box-selected </span>{
  <span style="font-weight: bold; font-style: italic;">border-color</span>: red <span style="font-weight: bold;">!important</span>;
}

<span style="font-weight: bold; font-style: italic;">/* </span><span style="font-weight: bold; font-style: italic;">left side </span><span style="font-weight: bold; font-style: italic;">*/</span>
<span style="font-weight: bold;">#route_specification </span>{
 <span style="font-weight: bold; font-style: italic;">display</span>: inline-block;
 <span style="font-weight: bold; font-style: italic;">width</span>: 400px;
}

<span style="font-weight: bold;">#current &gt; span.route_id </span>{
 <span style="font-weight: bold; font-style: italic;">display</span>: block;
}

<span style="font-weight: bold; font-style: italic;">/* </span><span style="font-weight: bold; font-style: italic;">right side </span><span style="font-weight: bold; font-style: italic;">*/</span>
<span style="font-weight: bold;">#list </span>{
  <span style="font-weight: bold; font-style: italic;">display</span>: inline-block;
  <span style="font-weight: bold; font-style: italic;">vertical-align</span>: top
}
<span style="font-weight: bold; font-style: italic;">/* </span><span style="font-weight: bold; font-style: italic;">display submited route statuses </span><span style="font-weight: bold; font-style: italic;">*/</span>
<span style="font-weight: bold;">ul.route_list &gt; li </span>{
 <span style="font-weight: bold; font-style: italic;">padding</span>: .2em;
 <span style="font-weight: bold; font-style: italic;">padding-bottom</span>: 1em;
}
<span style="font-weight: bold;">ul.route_list &gt; li &gt; span.info </span>{
 <span style="font-weight: bold; font-style: italic;">background-color</span>: lightblue;
 <span style="font-weight: bold; font-style: italic;">margin-right</span>: 1em;
 <span style="font-weight: bold; font-style: italic;">cursor</span>: pointer;
 <span style="font-weight: bold; font-style: italic;">margin-bottom</span>: solid darkblue 1px;
 <span style="font-weight: bold; font-style: italic;">border-bottom</span>: dashed black 1px;
}
<span style="font-weight: bold;">ul.route_list &gt; li &gt; span.info:hover, ul.route_list &gt; li &gt; span.info:active </span>{
 <span style="font-weight: bold; font-style: italic;">background-color</span>: lightgreen
}
<span style="font-weight: bold;">ul.route_list &gt; li &gt; span.person </span>{
  <span style="font-weight: bold; font-style: italic;">font-size</span>: 6pt;
  <span style="font-weight: bold; font-style: italic;">background-color</span>: gray;
  <span style="font-weight: bold; font-style: italic;">border-radius</span>: 5px;
  <span style="font-weight: bold; font-style: italic;">border</span>: solid black 1px;
  <span style="font-weight: bold; font-style: italic;">padding</span>: .2em;
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">model-view</h3>
<div class="outline-text-3" id="text-2-2">
</div><div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1">model</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
what do we want to track, what color, grade, and status options are allowed
</p>
<div class="org-src-container">

<pre class="src src-javascript"><span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">empty_route_info</span> = {
 <span style="font-style: italic;">'area'</span>: <span style="font-weight: bold; text-decoration: underline;">null</span>,
 <span style="font-style: italic;">'set_date'</span>: <span style="font-weight: bold; text-decoration: underline;">null</span>,
 <span style="font-style: italic;">'setter'</span>: <span style="font-weight: bold; text-decoration: underline;">null</span>,
 <span style="font-style: italic;">'name'</span>: <span style="font-weight: bold; text-decoration: underline;">null</span>,
 <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">status and rate are dropdowns</span>
 <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">must be "" instead of null so dropbox selects it</span>
 <span style="font-style: italic;">'grade_full'</span>: <span style="font-style: italic;">""</span>, 
 <span style="font-style: italic;">'status'</span>: <span style="font-style: italic;">""</span>, 
 <span style="font-style: italic;">'rate'</span>: <span style="font-style: italic;">""</span>,
 <span style="font-style: italic;">'color'</span>: <span style="font-style: italic;">""</span>, 
 <span style="font-style: italic;">'note'</span>: <span style="font-weight: bold; text-decoration: underline;">null</span>,
 <span style="font-style: italic;">'location'</span>: <span style="font-style: italic;">'TCW_boulder'</span>,
 <span style="font-style: italic;">'climber'</span>: <span style="font-weight: bold; text-decoration: underline;">null</span>
}
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">model</span> = 
 {<span style="font-style: italic;">'current'</span>: JSON.parse(JSON.stringify(empty_route_info)),
  <span style="font-style: italic;">'options'</span>: {
    <span style="font-style: italic;">'status'</span>: [<span style="font-style: italic;">'on-sight'</span>,<span style="font-style: italic;">'completed'</span>,<span style="font-style: italic;">'peiced'</span>,<span style="font-style: italic;">'75%'</span>,<span style="font-style: italic;">'50%'</span>,<span style="font-style: italic;">'25%'</span>,<span style="font-style: italic;">'started'</span>,<span style="font-style: italic;">'skipped'</span>],
    <span style="font-style: italic;">'color'</span>:  [<span style="font-style: italic;">'red'</span>,<span style="font-style: italic;">'orange'</span>,<span style="font-style: italic;">'yellow'</span>,<span style="font-style: italic;">'green'</span>,<span style="font-style: italic;">'blue'</span>,<span style="font-style: italic;">'pink'</span>,<span style="font-style: italic;">'black'</span>,<span style="font-style: italic;">'white'</span>,<span style="font-style: italic;">'stripped'</span>,<span style="font-style: italic;">'rainbow'</span>,<span style="font-style: italic;">'graphic'</span>],
    <span style="font-style: italic;">'grade'</span>:  [<span style="font-style: italic;">'B'</span>,0,1,2,3,4,5,6,7,8],
    <span style="font-style: italic;">'ratings'</span>: [1,2,3,4,5]
  },
  <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">left side lists of routes</span>
  <span style="font-style: italic;">'allroutes'</span>: [],
  <span style="font-style: italic;">'route_summaries'</span>: [],
 }
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2">View (and send)</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
Vue does the heaving lifting. define two functions
</p>
<ul class="org-ul">
<li>grade<sub>combined</sub> to change B to -1 and add the half grade
</li>
<li>addCurrent to send away the selection+status
</li>
</ul>
<div class="org-src-container">

<pre class="src src-javascript"><span style="font-weight: bold;">function</span> <span style="font-weight: bold;">sendaway</span>(<span style="font-weight: bold; font-style: italic;">data</span>) {
     <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">console.log('sending',data)</span>
     <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">x</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">XMLHttpRequest</span>()
     x.open(<span style="font-style: italic;">'POST'</span>,<span style="font-style: italic;">'/add'</span>,<span style="font-weight: bold; text-decoration: underline;">true</span>)
     x.setRequestHeader(<span style="font-style: italic;">"Content-type"</span>,<span style="font-style: italic;">"application/json"</span>)
     x.send(data)
}
<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">ajax_update</span>(<span style="font-weight: bold; font-style: italic;">path</span>,<span style="font-weight: bold; font-style: italic;">onready</span>){
     <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">x</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">XMLHttpRequest</span>()
     x.onreadystatechange = <span style="font-weight: bold;">function</span>() {
       <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.readyState == 4 &amp;&amp; <span style="font-weight: bold; text-decoration: underline;">this</span>.status == 200){
           onready(JSON.parse(x.response))
       }
     }
     x.open(<span style="font-style: italic;">'GET'</span>,path,<span style="font-weight: bold; text-decoration: underline;">true</span>)
     <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">x.setRequestHeader("Content-type","application/json") // overrideMimeType</span>
     x.send()
}
<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">format a date field in a list of hashes/dicts</span>
<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">from python datetime</span>
<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">frmt_date</span>(<span style="font-weight: bold; font-style: italic;">a</span>,<span style="font-weight: bold; font-style: italic;">field</span>) {
    <span style="font-weight: bold;">for</span>(<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">i</span>=0; i &lt; a.length; i++){
      <span style="font-weight: bold;">if</span>( ! a[i][field] ) { <span style="font-weight: bold;">continue</span> }
      <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">d</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Date</span>(a[i][field] * 1000)
      a[i][field] = d.toISOString().substr(0,16).replace(<span style="font-style: italic;">'T'</span>,<span style="font-style: italic;">' '</span>)
    }
    <span style="font-weight: bold;">return</span>(a)
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">isempty</span>(<span style="font-weight: bold; font-style: italic;">x</span>){ <span style="font-weight: bold;">return</span>( x === <span style="font-style: italic;">""</span> || x == <span style="font-weight: bold; text-decoration: underline;">null</span> || x == <span style="font-weight: bold; text-decoration: underline;">undefined</span>) }
<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">for filtering. return true when not set, or when matches</span>
<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">null_or_match</span>(<span style="font-weight: bold; font-style: italic;">x</span>,<span style="font-weight: bold; font-style: italic;">m</span>) {
  <span style="font-weight: bold;">if</span>( x !== 0 &amp;&amp; isempty(x) ) {
   <span style="font-weight: bold;">return</span>(<span style="font-weight: bold; text-decoration: underline;">true</span>)
  }
  <span style="font-weight: bold;">return</span>(x == m) 
}

<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">vueControler</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Vue</span>({
 el:<span style="font-style: italic;">"#climbing_spa"</span>,
 data: model, 
 computed: {
   <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">current_grade: this.grade_combined</span>
   <span style="font-weight: bold;">current_grade</span>: <span style="font-weight: bold;">function</span>(){
     grade = <span style="font-weight: bold; text-decoration: underline;">this</span>.current.grade_full == <span style="font-style: italic;">'B'</span> ? -1 : parseInt(<span style="font-weight: bold; text-decoration: underline;">this</span>.current.grade_full)
     <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">console.log('current_grade computed:',this.current.grade_full,grade,isNaN(grade))</span>
     <span style="font-weight: bold;">if</span>(isNaN(grade)){ <span style="font-weight: bold;">return</span>(<span style="font-weight: bold; text-decoration: underline;">null</span>) }
     <span style="font-weight: bold;">return</span> (grade + (<span style="font-weight: bold; text-decoration: underline;">this</span>.current.plus_half ? .5 : 0) )
   },
   <span style="font-weight: bold;">have_any_current</span>: <span style="font-weight: bold;">function</span>() {
      <span style="font-weight: bold;">return</span>(!isempty(<span style="font-weight: bold; text-decoration: underline;">this</span>.current.area)  ||
             !isempty(<span style="font-weight: bold; text-decoration: underline;">this</span>.current.color) || 
             !isempty(<span style="font-weight: bold; text-decoration: underline;">this</span>.current_grade) )
   },
   <span style="font-weight: bold;">have_all_current</span>: <span style="font-weight: bold;">function</span>() {
      <span style="font-weight: bold;">return</span>(!isempty(<span style="font-weight: bold; text-decoration: underline;">this</span>.current.area)  &amp;&amp;
             !isempty(<span style="font-weight: bold; text-decoration: underline;">this</span>.current.color) &amp;&amp; 
             !isempty(<span style="font-weight: bold; text-decoration: underline;">this</span>.current_grade) )
   }

 },
 methods: {
   <span style="font-weight: bold;">setClimber</span>: <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">climber</span>){
      <span style="font-weight: bold;">if</span>(climber === <span style="font-weight: bold; text-decoration: underline;">null</span> ){
          climber =  prompt(<span style="font-style: italic;">'Who are you?'</span>)
      }
      empty_route_info[<span style="font-style: italic;">'climber'</span>] = climber
      <span style="font-weight: bold; text-decoration: underline;">this</span>.current.climber = empty_route_info[<span style="font-style: italic;">'climber'</span>]
      <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">set cookie</span>
      document.cookie = <span style="font-style: italic;">"max-age=31536000"</span>
      document.cookie = <span style="font-style: italic;">"climber="</span>+ climber
   },
   <span style="font-weight: bold;">matches_current</span>: <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">r</span>){

     <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">console.log('match current? r:',JSON.stringify(r),' current:',JSON.stringify(this.current))</span>
     <span style="font-weight: bold;">return</span>( null_or_match(<span style="font-weight: bold; text-decoration: underline;">this</span>.current.color,r.color) &amp;&amp;
             null_or_match(<span style="font-weight: bold; text-decoration: underline;">this</span>.current_grade,r.grade) &amp;&amp;
             null_or_match(<span style="font-weight: bold; text-decoration: underline;">this</span>.current.area, r.area) )

   },
   <span style="font-weight: bold;">grade_combined</span>: <span style="font-weight: bold;">function</span>(){
     <span style="font-weight: bold;">return</span>(<span style="font-weight: bold; text-decoration: underline;">this</span>.current_grade)
   },
   <span style="font-weight: bold;">setCurrent</span>: <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">r</span>){
    console.log(<span style="font-style: italic;">'setCurrent'</span>,JSON.stringify(r))
    <span style="font-weight: bold; text-decoration: underline;">this</span>.current.color = r.color
    <span style="font-weight: bold; text-decoration: underline;">this</span>.current.area = r.area
    <span style="font-weight: bold; text-decoration: underline;">this</span>.current.name = r.name
    <span style="font-weight: bold; text-decoration: underline;">this</span>.current.setter =  r.setter
    area_id = <span style="font-style: italic;">'#area_'</span> + r.area
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">this calls to var and function created later by d3</span>
    svgdiv.select(area_id).each(select_area)

    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">grade_full is without the .5, and B if -1</span>
    newgrade = parseFloat(r.grade)
    <span style="font-weight: bold;">if</span>(isNaN(newgrade)){newgrade = 0}
    <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">console.log('setCurrent grade from-&gt;to:',this.current.grade_full, r.grade, newgrade)</span>
    <span style="font-weight: bold;">if</span>( newgrade &lt; 0 ){
      <span style="font-weight: bold; text-decoration: underline;">this</span>.current.grade_full == <span style="font-style: italic;">"B"</span>
    }<span style="font-weight: bold;">else</span> {   
      <span style="font-weight: bold; text-decoration: underline;">this</span>.current.grade_full = Math.floor(newgrade)
    }

    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">update half point checkbox</span>
    newplushalf=(newgrade != Math.floor(newgrade))
    <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">console.log('setCurrent half old,new: ',this.current.plus_half, newplushalf)</span>
    <span style="font-weight: bold; text-decoration: underline;">this</span>.current.plus_half = newplushalf

    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">research all logs of this </span>
    listURL = [<span style="font-style: italic;">'list'</span>, <span style="font-weight: bold; text-decoration: underline;">this</span>.current.location, <span style="font-weight: bold; text-decoration: underline;">this</span>.current.area,<span style="font-weight: bold; text-decoration: underline;">this</span>.current.color, <span style="font-weight: bold; text-decoration: underline;">this</span>.current_grade].join(<span style="font-style: italic;">'/'</span>)
    ajax_update(<span style="font-style: italic;">'/'</span> + listURL, <span style="font-weight: bold; text-decoration: underline;">this</span>.fetchAllstatuses)
    console.log(<span style="font-style: italic;">'updated allroutes'</span>, <span style="font-weight: bold; text-decoration: underline;">this</span>.allroutes)
   },
   <span style="font-weight: bold;">addCurrent</span>: <span style="font-weight: bold;">function</span>(){
     <span style="font-weight: bold; text-decoration: underline;">this</span>.current.grade = <span style="font-weight: bold; text-decoration: underline;">this</span>.grade_combined()
     data = JSON.stringify(<span style="font-weight: bold; text-decoration: underline;">this</span>.current)
     sendaway(data)
     <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">update view to empyt state</span>
     <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">TODO: maybe keep</span>
     <span style="font-weight: bold; text-decoration: underline;">this</span>.updateList()
     <span style="font-weight: bold; text-decoration: underline;">this</span>.reset_current()
   },
   <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">cannot use until page is loaded because reset color defied later</span>
   <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">means we code copy of empty_route_info twice</span>
   <span style="font-weight: bold;">reset_current</span>: <span style="font-weight: bold;">function</span>(){
     <span style="font-weight: bold; text-decoration: underline;">this</span>.current = JSON.parse(JSON.stringify(empty_route_info))
     reset_color()
   },
   <span style="font-weight: bold;">updateList</span>: <span style="font-weight: bold;">function</span>() {
     console.log(<span style="font-style: italic;">'update summary'</span>)
     <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">all routes</span>
     ajax_update(<span style="font-style: italic;">'/summary/'</span>+<span style="font-weight: bold; text-decoration: underline;">this</span>.current.location, <span style="font-weight: bold; text-decoration: underline;">this</span>.fetchClimbSummaries)

     <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">all statuses</span>
     <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">ajax_update('/list/'+this.current.location, this.fetchAllstatuses)</span>
   },
   <span style="font-weight: bold; font-style: italic;">/* </span><span style="font-weight: bold; font-style: italic;">get data from api server */</span>
   <span style="font-weight: bold;">fetchAllstatuses</span>: <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">d</span>){
    <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">self</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>
    console.log(d)
    self.allroutes = frmt_date(d,<span style="font-style: italic;">'timestamp'</span>)
   },
   <span style="font-weight: bold;">fetchClimbSummaries</span>: <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">d</span>){
    <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">self</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>
    console.log(d)
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">clean up: unixtimestamp to iso date</span>
    self.route_summaries = frmt_date(d,<span style="font-style: italic;">'recent'</span>)
   },

 },
 <span style="font-weight: bold;">mounted</span>: <span style="font-weight: bold;">function</span>(){
     <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">console.log('mounting')</span>
     <span style="font-weight: bold; text-decoration: underline;">this</span>.updateList()
     <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">use cookie or prompt for climber(user)</span>
     <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">should match climber=MY_CLIMBING_ID</span>
     console.log(<span style="font-style: italic;">'setting cookie'</span>)
     m=decodeURIComponent(document.cookie).match(<span style="font-style: italic;">'climber=([^;]+)'</span>)
     climber=m?m[1]:<span style="font-weight: bold; text-decoration: underline;">null</span>
     <span style="font-weight: bold; text-decoration: underline;">this</span>.setClimber(climber)
     console.log(<span style="font-style: italic;">'climber = '</span>,<span style="font-weight: bold; text-decoration: underline;">this</span>.current.climber,<span style="font-style: italic;">'; should be:'</span>, climber)
 }
})
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">selecting areas</h3>
<div class="outline-text-3" id="text-2-3">
<p>
We want to click an area. This depends on the svg floor plan loaded later.
</p>
<div class="org-src-container">

<pre class="src src-javascript"> <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">setup</span>
<span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">var svgdiv = d3.select("body").append("div");</span>
<span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">svgdiv.attr("id","climbingAreas")</span>
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">svgdiv</span> = d3.select(<span style="font-style: italic;">"div#climbingAreas"</span>);


<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">svg</span>;
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">clickable</span>;

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">reset_color</span>() {
  clickable.each( <span style="font-weight: bold;">function</span>() {
      d3.select(<span style="font-weight: bold; text-decoration: underline;">this</span>).style(<span style="font-style: italic;">'fill'</span>,<span style="font-style: italic;">'green'</span>)  
  })
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">select_area</span>() {
 reset_color()
 area = d3.select(<span style="font-weight: bold; text-decoration: underline;">this</span>)
 area.style(<span style="font-style: italic;">'fill'</span>,<span style="font-style: italic;">'red'</span>)
 name = area.attr(<span style="font-style: italic;">'id'</span>).match(<span style="font-style: italic;">/area_(.*)/</span>)[1]
 model.current.area = name
 console.log(name)
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">inserting svg and area clicks</h3>
<div class="outline-text-3" id="text-2-4">
<p>
  The floor plan for the boldering area has already been created as an svg.
<code>rect</code> and <code>path</code> svg elements define areas that will contain routes and have an ID starting with <code>area_</code>.
</p>
<div class="org-src-container">

<pre class="src src-javascript"><span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">inject svg, define clickable</span>
d3.xml(<span style="font-style: italic;">"outline.svg"</span>, <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">error</span>, <span style="font-weight: bold; font-style: italic;">documentFragment</span>) {
        <span style="font-weight: bold;">if</span> (error) {console.log(error); <span style="font-weight: bold;">return</span>;}

        svgdiv.node().appendChild(
             documentFragment.getElementsByTagName(<span style="font-style: italic;">"svg"</span>)[0]
        );

        svg = svgdiv.select(<span style="font-style: italic;">"svg"</span>)

        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">shrink </span>
        svg.attr(<span style="font-style: italic;">"width"</span>, <span style="font-style: italic;">"400"</span>)
        svg.attr(<span style="font-style: italic;">"height"</span>, <span style="font-style: italic;">"250"</span>)

        allpaths = svg.selectAll(<span style="font-style: italic;">'path,rect'</span>)

        clickable = allpaths.filter(<span style="font-weight: bold;">function</span>() {
             id=d3.select(<span style="font-weight: bold; text-decoration: underline;">this</span>).attr(<span style="font-style: italic;">'id'</span>)
             <span style="font-weight: bold;">return</span>( id !== <span style="font-weight: bold; text-decoration: underline;">null</span> &amp;&amp; id.match(<span style="font-style: italic;">/area/</span>) !== <span style="font-weight: bold; text-decoration: underline;">null</span> ) 
        })

        clickable.each( <span style="font-weight: bold;">function</span>() {
              p=d3.select(<span style="font-weight: bold; text-decoration: underline;">this</span>)
              p.style(<span style="font-style: italic;">'cursor'</span>,<span style="font-style: italic;">'pointer'</span>)
              p.on(<span style="font-style: italic;">'click'</span>,select_area)
        })
    });
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5">Server</h3>
<div class="outline-text-3" id="text-2-5">
<p>
We want to log this persistent. It'd be cool to compare to others too. First lets just get recording working.
<a href="http://localhost:8080/index.html">http://localhost:8080/index.html</a>
</p>
</div>

<div id="outline-container-sec-2-5-1" class="outline-4">
<h4 id="sec-2-5-1">testing the server</h4>
<div class="outline-text-4" id="text-2-5-1">
<div class="org-src-container">

<pre class="src src-bash">data='{"color": "red", "grade": 3, 
     "area": "45",
     "status": "completed", "rate": 4,
     "note": "fun",
     "location": "TCW_boulder",
     "climber": "WF"
    }'
http POST http://localhost:8080/add Content-type:application/json &lt;&lt;&lt;"$data"
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-5-2" class="outline-4">
<h4 id="sec-2-5-2">quick API</h4>
<div class="outline-text-4" id="text-2-5-2">
<p>
Written with bottle. Statically serving other files.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env python3</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">(elpy-use-ipython)</span>
<span style="font-weight: bold;">from</span> bottle <span style="font-weight: bold;">import</span> route, run, post, static_file, request, response
<span style="font-weight: bold;">from</span> tinydb <span style="font-weight: bold;">import</span> TinyDB, Query
<span style="font-weight: bold;">import</span> datetime
<span style="font-weight: bold;">import</span> json
<span style="font-weight: bold;">from</span> climb_summary <span style="font-weight: bold;">import</span> climb_summary

<span style="font-weight: bold; font-style: italic;">db</span> = TinyDB(<span style="font-style: italic;">'./climbing_status.json'</span>)


<span style="font-weight: bold; text-decoration: underline;">@route</span>(<span style="font-style: italic;">'/add'</span>,method=<span style="font-style: italic;">'POST'</span>)
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">add</span>():
    <span style="font-weight: bold; font-style: italic;">data</span> = request.json
    <span style="font-weight: bold; font-style: italic;">data</span>[<span style="font-style: italic;">'timestamp'</span>] = datetime.datetime.now().timestamp()
    <span style="font-weight: bold;">print</span>(data)
    db.insert(data)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">just list all statuses from a location</span>
<span style="font-weight: bold; text-decoration: underline;">@route</span>(<span style="font-style: italic;">'/list/&lt;location&gt;'</span>)
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">list</span>(location=<span style="font-style: italic;">"TCW_boulder"</span>):
    <span style="font-weight: bold; font-style: italic;">q</span> = Query()
    <span style="font-weight: bold; font-style: italic;">r</span> = db.search(q.location == location)
    <span style="font-weight: bold; font-style: italic;">response.content_type</span> = <span style="font-style: italic;">'application/json'</span>
    <span style="font-weight: bold;">return</span> json.dumps(r)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">list summary for a location</span>
<span style="font-weight: bold; text-decoration: underline;">@route</span>(<span style="font-style: italic;">'/summary'</span>)
<span style="font-weight: bold; text-decoration: underline;">@route</span>(<span style="font-style: italic;">'/summary/&lt;location&gt;'</span>)
<span style="font-weight: bold; text-decoration: underline;">@route</span>(<span style="font-style: italic;">'/summary/&lt;location&gt;/&lt;sortby&gt;'</span>)
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">list</span>(location=<span style="font-style: italic;">"TCW_boulder"</span>,sortby=<span style="font-style: italic;">"cnt"</span>):
    <span style="font-weight: bold; font-style: italic;">q</span> = Query()
    <span style="font-weight: bold; font-style: italic;">r</span> = db.search(q.location == location)
    <span style="font-weight: bold; font-style: italic;">s</span> = climb_summary(r,sortby)
    <span style="font-weight: bold; font-style: italic;">response.content_type</span> = <span style="font-style: italic;">'application/json'</span>
    <span style="font-weight: bold;">return</span> json.dumps(s)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">specific route information</span>
<span style="font-weight: bold; text-decoration: underline;">@route</span>(<span style="font-style: italic;">'/list/&lt;location&gt;/&lt;area&gt;/&lt;color&gt;/&lt;grade&gt;'</span>)
<span style="font-weight: bold; text-decoration: underline;">@route</span>(<span style="font-style: italic;">'/list/&lt;location&gt;/&lt;area&gt;/&lt;color&gt;/&lt;grade&gt;/&lt;sortby&gt;'</span>)
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">list</span>(location,area,color,grade,sortby=<span style="font-style: italic;">"cnt"</span>):
    <span style="font-weight: bold; font-style: italic;">q</span> = Query()
    <span style="font-weight: bold; font-style: italic;">r</span> = db.search( (q.location == location) &amp; (q.area == area) &amp;
                   (q.color == color) &amp; (q.grade == <span style="font-weight: bold;">float</span>(grade)) )
    <span style="font-weight: bold; font-style: italic;">response.content_type</span> = <span style="font-style: italic;">'application/json'</span>
    <span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">print('looking for loc "%s" area "%s" color "%s" grade "%s"' % (location, area, color, grade) )</span>
    <span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">print("found %d" % len(r))</span>
    <span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">s = climb_summary(r,sortby)</span>
    <span style="font-weight: bold;">return</span> json.dumps(r)


<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">all filenames are static</span>
<span style="font-weight: bold; text-decoration: underline;">@route</span>(<span style="font-style: italic;">'/'</span>)
<span style="font-weight: bold; text-decoration: underline;">@route</span>(<span style="font-style: italic;">'/&lt;filename&gt;'</span>)
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">static_f</span>(filename=<span style="font-style: italic;">'index.html'</span>):
    <span style="font-weight: bold;">return</span>(static_file(filename, root=<span style="font-style: italic;">"./"</span>))


run(host=<span style="font-style: italic;">'0.0.0.0'</span>,port=8080)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-5-3" class="outline-4">
<h4 id="sec-2-5-3">supporting functions</h4>
<div class="outline-text-4" id="text-2-5-3">
<p>
this file exists to summarize the list of climbing statuses 
the heavy lifting is done by <code>try_fill</code> which is a bad attempt at merging under specified climbing routes within a status to fully specified routes.
no attempt is made to merge non-overlapping partials.
set date is still ignored
</p>
</div>
<ul class="org-ul"><li><a id="sec-2-5-3-1" name="sec-2-5-3-1"></a><span class="todo TODO">TODO</span> add set date to <code>try_fill</code> and friends<br ><div class="outline-text-5" id="text-2-5-3-1">
<div class="org-src-container">

<pre class="src src-python"><span style="font-weight: bold;">from</span> itertools <span style="font-weight: bold;">import</span> groupby
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">helper functions</span>
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">groupinfo</span>(itera):
    <span style="font-style: italic;">"""</span>
<span style="font-style: italic;">    :param itera: array iterator of climbing route dicts from groupby</span>
<span style="font-style: italic;">    :returns: (dict) with summary stats for that group </span>
<span style="font-style: italic;">    """</span>
    <span style="font-weight: bold; font-style: italic;">a</span> = <span style="font-weight: bold;">list</span>(itera)

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">rank calc requries a filter</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">mabye worth importing numpy</span>
    <span style="font-weight: bold; font-style: italic;">ranks</span> = <span style="font-weight: bold;">list</span>(<span style="font-weight: bold;">filter</span>( <span style="font-weight: bold;">lambda</span> x: x <span style="font-weight: bold;">is</span> <span style="font-weight: bold;">not</span> <span style="font-weight: bold; text-decoration: underline;">None</span>, [x.get(<span style="font-style: italic;">'rank'</span>,<span style="font-weight: bold; text-decoration: underline;">None</span>) <span style="font-weight: bold;">for</span> x <span style="font-weight: bold;">in</span> a]))
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold;">len</span>(ranks) &gt; 0:
        <span style="font-weight: bold; font-style: italic;">avgrank</span> = <span style="font-weight: bold;">sum</span>(ranks)/<span style="font-weight: bold;">len</span>(ranks)
    <span style="font-weight: bold;">else</span>:
        <span style="font-weight: bold; font-style: italic;">avgrank</span> = <span style="font-weight: bold; text-decoration: underline;">None</span>

    <span style="font-weight: bold; font-style: italic;">d</span> = { <span style="font-style: italic;">'cnt'</span>: <span style="font-weight: bold;">len</span>(a),
          <span style="font-style: italic;">'recent'</span>: <span style="font-weight: bold;">max</span>([0] + [x.get(<span style="font-style: italic;">'timestamp'</span>,0) <span style="font-weight: bold;">for</span> x <span style="font-weight: bold;">in</span> a]),
          <span style="font-style: italic;">'avgrank'</span>: avgrank,
        }
    <span style="font-weight: bold;">return</span>(d)

<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">climb_summary</span>(r,sortby=<span style="font-style: italic;">'cnt'</span>):
    <span style="font-weight: bold; font-style: italic;">header</span>=[<span style="font-style: italic;">'location'</span>,<span style="font-style: italic;">'area'</span>,<span style="font-style: italic;">'color'</span>,<span style="font-style: italic;">'grade'</span>,<span style="font-style: italic;">'setter'</span>,<span style="font-style: italic;">'name'</span>]
    <span style="font-weight: bold; font-style: italic;">g</span> = groupby(r,<span style="font-weight: bold;">lambda</span> x: [x.get(k) <span style="font-weight: bold;">for</span> k <span style="font-weight: bold;">in</span> header] )
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">summarise all status into count and recent</span>
    <span style="font-weight: bold; font-style: italic;">s</span> = [{<span style="font-style: italic;">'info'</span>: k,
          **groupinfo(a),
          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">nfilled is the number of good values we have</span>
          <span style="font-style: italic;">'nfilled'</span>: <span style="font-weight: bold;">int</span>(k[header.index(<span style="font-style: italic;">'setter'</span>)] <span style="font-weight: bold;">not</span> <span style="font-weight: bold;">in</span> [<span style="font-weight: bold; text-decoration: underline;">None</span>, <span style="font-style: italic;">""</span>]) +
                     <span style="font-weight: bold;">int</span>(k[header.index(<span style="font-style: italic;">'name'</span>)] <span style="font-weight: bold;">not</span> <span style="font-weight: bold;">in</span> [<span style="font-weight: bold; text-decoration: underline;">None</span>,<span style="font-style: italic;">""</span>])
          } <span style="font-weight: bold;">for</span> k, a <span style="font-weight: bold;">in</span> g]

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">break back into array of dict</span>
    <span style="font-weight: bold; font-style: italic;">d</span> = [ {
          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">put back info as dict</span>
          **{k: v <span style="font-weight: bold;">for</span> k,v <span style="font-weight: bold;">in</span> <span style="font-weight: bold;">zip</span>(header,x[<span style="font-style: italic;">'info'</span>])},
          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">also add any other stats that we computed</span>
          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip 'info' </span>
          **{k: x[k] <span style="font-weight: bold;">for</span> k <span style="font-weight: bold;">in</span> x <span style="font-weight: bold;">if</span> k <span style="font-weight: bold;">not</span> <span style="font-weight: bold;">in</span> [<span style="font-style: italic;">'info'</span>]}
        } <span style="font-weight: bold;">for</span> x <span style="font-weight: bold;">in</span> s]


    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">re-group to merge where setter or name is empty</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">maybe we should do this will pandas forwardfill fillna </span>
    <span style="font-weight: bold; font-style: italic;">d</span> = fill_idna(d)


    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">sort</span>
    <span style="font-weight: bold; font-style: italic;">s</span> = <span style="font-weight: bold;">sorted</span>(d, key=<span style="font-weight: bold;">lambda</span> x: x[sortby] )

    <span style="font-weight: bold;">return</span>(d)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">this is absolutely misguided</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">for a group of climbing dictionaries</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">that all have the same loc,area,color, and grade</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">match setter and name when we can</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">might do terrible things when have only partial info for more than one climb</span>
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">try_fill</span>(itera):
    <span style="font-style: italic;">"""</span>
<span style="font-style: italic;">    example</span>
<span style="font-style: italic;">    -------</span>
<span style="font-style: italic;">    itera = [</span>
<span style="font-style: italic;">    {'nfilled': 2, 'setter': 'ab', 'name': 'xx', 'avgrank': 3, 'cnt': 10, 'recent': 9}, </span>
<span style="font-style: italic;">    {'nfilled': 1, 'setter': 'ab', 'name': '', 'avgrank': 1, 'cnt': 2, 'recent': 0},</span>
<span style="font-style: italic;">    {'nfilled': 1, 'setter': '', 'name': 'xx', 'avgrank': 5, 'cnt': 1, 'recent': 10}]</span>
<span style="font-style: italic;">    """</span>
    <span style="font-weight: bold; font-style: italic;">a_sorted</span> = <span style="font-weight: bold;">sorted</span>(itera,key=<span style="font-weight: bold;">lambda</span> x: -x.get(<span style="font-style: italic;">'nfilled'</span>,0))

    <span style="font-weight: bold; font-style: italic;">matching</span> = [<span style="font-style: italic;">'setter'</span>,<span style="font-style: italic;">'name'</span>]

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">build truth</span>
    <span style="font-weight: bold; font-style: italic;">truth</span> = []
    <span style="font-weight: bold;">while</span> <span style="font-weight: bold;">len</span>(a_sorted) &gt;0 <span style="font-weight: bold;">and</span> a_sorted[0][<span style="font-style: italic;">'nfilled'</span>] &gt;= 2:
        truth.append( a_sorted.pop(0) )
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">compare the rest to the truth</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">add together if matches</span>
    <span style="font-weight: bold;">for</span> ti <span style="font-weight: bold;">in</span> <span style="font-weight: bold;">range</span>(<span style="font-weight: bold;">len</span>(truth)):
      <span style="font-weight: bold; font-style: italic;">t</span> = truth[ti]
      <span style="font-weight: bold; font-style: italic;">a_keep</span> = []
      <span style="font-weight: bold;">for</span> ai <span style="font-weight: bold;">in</span> <span style="font-weight: bold;">range</span>(<span style="font-weight: bold;">len</span>(a_sorted)):
          <span style="font-weight: bold; font-style: italic;">a</span> = a_sorted[ai]
          <span style="font-weight: bold; font-style: italic;">nmatches</span> = <span style="font-weight: bold;">sum</span>([ <span style="font-weight: bold;">int</span>(t.get(i) == a.get(i) <span style="font-weight: bold;">and</span> t.get(i) <span style="font-weight: bold;">is</span> <span style="font-weight: bold;">not</span> <span style="font-weight: bold; text-decoration: underline;">None</span>) <span style="font-weight: bold;">for</span> i <span style="font-weight: bold;">in</span> matching])
          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if we matched all the good parts of our partially emtpy dict</span>
          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">update truth with this count and remove from a</span>
          <span style="font-weight: bold;">if</span> nmatches == a[<span style="font-style: italic;">'nfilled'</span>]:
              truth[ti][<span style="font-style: italic;">'recent'</span>] = <span style="font-weight: bold;">max</span>(t[<span style="font-style: italic;">'recent'</span>],a[<span style="font-style: italic;">'recent'</span>])
              truth[ti][<span style="font-style: italic;">'cnt'</span>] = t[<span style="font-style: italic;">'cnt'</span>]+a[<span style="font-style: italic;">'cnt'</span>]

              <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">deal with null avgrank</span>
              <span style="font-weight: bold; font-style: italic;">cnt</span>=1
              <span style="font-weight: bold;">if</span> t[<span style="font-style: italic;">'avgrank'</span>]:
                 <span style="font-weight: bold; font-style: italic;">tavg</span> = t[<span style="font-style: italic;">'cnt'</span>]*t[<span style="font-style: italic;">'avgrank'</span>] 
                 <span style="font-weight: bold; font-style: italic;">cnt</span> = t[<span style="font-style: italic;">'cnt'</span>]
              <span style="font-weight: bold;">else</span>:
                 <span style="font-weight: bold; font-style: italic;">tavg</span> = 0
              <span style="font-weight: bold;">if</span> a[<span style="font-style: italic;">'avgrank'</span>]:
                 <span style="font-weight: bold; font-style: italic;">aavg</span> = a[<span style="font-style: italic;">'cnt'</span>]*a[<span style="font-style: italic;">'avgrank'</span>] 
                 <span style="font-weight: bold; font-style: italic;">cnt</span> = cnt + t[<span style="font-style: italic;">'cnt'</span>]
              <span style="font-weight: bold;">else</span>:
                 <span style="font-weight: bold; font-style: italic;">aavg</span>=0

              truth[ti][<span style="font-style: italic;">'avgrank'</span>] = (tavg + aavg)/cnt

          <span style="font-weight: bold;">else</span>:
              a_keep.append(ai)
      <span style="font-weight: bold; font-style: italic;">a_sorted</span> = [a_sorted[i] <span style="font-weight: bold;">for</span> i <span style="font-weight: bold;">in</span> a_keep]

    <span style="font-weight: bold;">return</span>(truth + a_sorted)


<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">fill_idna</span>(d):
    <span style="font-weight: bold; font-style: italic;">header</span> = [<span style="font-style: italic;">'location'</span>,<span style="font-style: italic;">'area'</span>,<span style="font-style: italic;">'color'</span>,<span style="font-style: italic;">'grade'</span>]
    <span style="font-weight: bold; font-style: italic;">g</span> = groupby(d, <span style="font-weight: bold;">lambda</span> x: [x.get(h) <span style="font-weight: bold;">for</span> h <span style="font-weight: bold;">in</span>  header])
    <span style="font-weight: bold; font-style: italic;">m</span> = [ {
           <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">header as dict</span>
           **{k:v <span style="font-weight: bold;">for</span> k,v <span style="font-weight: bold;">in</span> <span style="font-weight: bold;">zip</span>(header,i)},
           <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">and merged (and leftovers) for this id</span>
           **x} 
        <span style="font-weight: bold;">for</span> i, a <span style="font-weight: bold;">in</span> g
        <span style="font-weight: bold;">for</span> x <span style="font-weight: bold;">in</span> try_fill(a) ]
    <span style="font-weight: bold;">return</span>(m)

<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">to_df_fill</span>(r):
 <span style="font-weight: bold; font-style: italic;">df</span> = pd.DataFrame(r).\
      assign(nrate= <span style="font-weight: bold;">lambda</span> x: x.rank <span style="font-weight: bold;">is</span> <span style="font-weight: bold;">not</span> <span style="font-weight: bold; text-decoration: underline;">None</span>).\
      groupby([<span style="font-style: italic;">'location'</span>,<span style="font-style: italic;">'area'</span>,<span style="font-style: italic;">'color'</span>,<span style="font-style: italic;">'grade'</span>]).\
      aggregate(
       {<span style="font-style: italic;">'timestamp'</span>: <span style="font-style: italic;">'max'</span>,
        <span style="font-style: italic;">'climber'</span>: <span style="font-weight: bold;">lambda</span> x: x.size,
        <span style="font-style: italic;">'rate'</span>: <span style="font-style: italic;">'sum'</span>,
        <span style="font-style: italic;">'nrate'</span>: <span style="font-style: italic;">'sum'</span>
        })

 <span style="font-weight: bold;">return</span>(df.T.to_dict().values() )
</pre>
</div>
</div>
</li></ul>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Log</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li><span class="timestamp-wrapper"><span class="timestamp">&lt;2017-11-20 Mon&gt;</span></span> - color,grade+half,area model&lt;-&gt;view connected - 1h
</li>
<li><span class="timestamp-wrapper"><span class="timestamp">&lt;2017-11-29 Wed&gt;</span></span> - python api (bottle+tinydb), ajax submit, list routes
</li>
<li><span class="timestamp-wrapper"><span class="timestamp">&lt;2017-11-30 Thu&gt;</span></span> - highlight route on list click, reset input on submit
</li>
<li><span class="timestamp-wrapper"><span class="timestamp">&lt;2017-12-01 Fri&gt;</span></span> - style, "" instead of null for selection, db summery routes
</li>
<li><span class="timestamp-wrapper"><span class="timestamp">&lt;2017-12-02 Sat&gt;</span></span> - simpler interface, "user"
</li>
<li><span class="timestamp-wrapper"><span class="timestamp">&lt;2017-12-05 Tue&gt;</span></span> - add green to colors, textbox for set<sub>date</sub>
</li>
</ul>
</div>

<div id="outline-container-sec-3-0-1" class="outline-4">
<h4 id="sec-3-0-1"><span class="done DONE">DONE</span> integrate summary with display</h4>
<div class="outline-text-4" id="text-3-0-1">
</div>
</div>
<div id="outline-container-sec-3-0-2" class="outline-4">
<h4 id="sec-3-0-2"><span class="todo TODO">TODO</span> filter summary color/grade/area</h4>
<div class="outline-text-4" id="text-3-0-2">
</div>
<ul class="org-ul"><li><a id="sec-3-0-2-1" name="sec-3-0-2-1"></a><span class="todo TODO">TODO</span> set<sub>date</sub><br ></li></ul>
</div>
<div id="outline-container-sec-3-0-3" class="outline-4">
<h4 id="sec-3-0-3"><span class="todo TODO">TODO</span> fix -1=&gt;"B" on span route list click</h4>
</div>
<div id="outline-container-sec-3-0-4" class="outline-4">
<h4 id="sec-3-0-4"><span class="done DONE">DONE</span> user</h4>
</div>
<div id="outline-container-sec-3-0-5" class="outline-4">
<h4 id="sec-3-0-5"><span class="todo TODO">TODO</span> different locations</h4>
</div>
<div id="outline-container-sec-3-0-6" class="outline-4">
<h4 id="sec-3-0-6"><span class="done DONE">DONE</span> location summary</h4>
</div>
<div id="outline-container-sec-3-0-7" class="outline-4">
<h4 id="sec-3-0-7"><span class="done DONE">DONE</span> add edit: notes, rate, name, setter</h4>
</div>
<div id="outline-container-sec-3-0-8" class="outline-4">
<h4 id="sec-3-0-8"><span class="todo TODO">TODO</span> remove routes/reset wall</h4>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: <span class="timestamp-wrapper"><span class="timestamp">&lt;2017-11-19 Sun&gt;</span></span></p>
<p class="date">Created: 2017-12-09 Sat 16:27</p>
<p class="creator"></p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
