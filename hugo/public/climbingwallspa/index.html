<!DOCTYPE html>
<html>
  <head>
    <title>Climbing Wall Route Annotation SPA</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <link rel="alternate" type="application/rss+xml" title="WFLOG RSS Feed" href="index.xml" />
    <link rel="shortcut icon" href="https://secure.gravatar.com/avatar/3fed911ae9175eaf6c4e4ec51de7e6ac?size=125">
  </head>
  <body style="max-width: 40em">

    <h1 style="font-size:bigger">Climbing Wall Route Annotation SPA</h1>
    <div class="content">
      
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
What
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>The Climbing Wall (TCW) has routes densily packed through different areas.
 To track our effort, we 1) identify the route and 2) annotate our progress.</p>
<div id="outline-container-headline-2" class="outline-3">
<h3 id="headline-2">
identify
</h3>
<div id="outline-text-headline-2" class="outline-text-3">
<p>Some routes have names. Most routes have the setter&#39;s initials. All routes have a color and grading (VB-V9).
   Colors are repeated in different areas and occasionally within in an area, but the combined area, color, and difficulty should uniquely identify each route.</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
annotate
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<p>We might care about</p>
<ul>
<li>fun factor (e.g. stars)</li>
<li>precieved difficultly (within grade): easy,expected,hard</li>
<li>flashed/onsite, completed, in-progress (% done?), skipped</li>
<li>last attempt (day + % complete)</li>
</ul>
</div>
</div>
<div id="outline-container-headline-4" class="outline-3">
<h3 id="headline-4">
limitation&#39;s of org-mode tangle
</h3>
<div id="outline-text-headline-4" class="outline-text-3">
<ul>
<li>line number error messages mean nothing</li>
<li>quick edits are hard, collaboration is near impossible</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-5" class="outline-2">
<h2 id="headline-5">
Code
</h2>
<div id="outline-text-headline-5" class="outline-text-2">
<div id="outline-container-headline-6" class="outline-3">
<h3 id="headline-6">
The html for the SPA only calls javascript (which among other things, inserts the svg
</h3>
<div id="outline-text-headline-6" class="outline-text-3">
<div class="src src-html">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">title</span>&gt; TCW Route Tracker &lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!--
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;script src=&#34;https://unpkg.com/vue&#34;&gt;&lt;/script&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;script src=&#34;https://d3js.org/d3.v4.min.js&#34;&gt;&lt;/script&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;vue&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;d3.v4.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;style.css&#34;</span>&gt; &lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt; 
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- vue --&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;climbing_spa&#34;</span>&gt;
</span></span><span style="display:flex;"><span> &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;who-are-we&#34;</span>&gt;
</span></span><span style="display:flex;"><span> logging as {{current.climber}} &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;clickable&#34;</span> <span style="color:#a6e22e">v-on:click</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;setClimber(null)&#34;</span>&gt;change&lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span> &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span> &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;route_specification&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">&lt;!-- to submit: route status and specific info --&gt;</span> 
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">v-on:click</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;reset_current()&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;clickable&#34;</span> <span style="color:#a6e22e">v-show</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;have_any_current&#34;</span>&gt; x &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">&lt;!--  debug v-if displays
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   all: {{have_all_current}} &lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   any: {{have_any_current}} &lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   {{current.area  != null }} {{current.color != null }} {{current_grade != null}}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   &lt;br&gt; current_grade: {{ current_grade }} | {{current.grade_full}} + {{current.plus_half}}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    --&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;current&#34;</span> <span style="color:#a6e22e">v-show</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;have_all_current&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;route_id&#34;</span>&gt; 
</span></span><span style="display:flex;"><span>     {{current.color}} {{grade_combined()}} on {{current.area}} 
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">br</span> /&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">v-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;current.status&#34;</span> &gt;
</span></span><span style="display:flex;"><span>     &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#a6e22e">disabled</span> <span style="color:#a6e22e">selected</span>&gt;status&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>     &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">v-for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;s in options.status&#34;</span> &gt;{{s}}&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">v-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;current.rate&#34;</span> &gt;
</span></span><span style="display:flex;"><span>     &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#a6e22e">disabled</span> <span style="color:#a6e22e">selected</span>&gt;rate&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>     &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">v-for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;r in options.ratings&#34;</span>&gt;{{r}}&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;notes&#34;</span> <span style="color:#a6e22e">v-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;current.note&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">br</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;setter&#34;</span> <span style="color:#a6e22e">v-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;current.setter&#34;</span> <span style="color:#a6e22e">size</span><span style="color:#f92672">=</span><span style="color:#e6db74">3</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;00/00&#34;</span> <span style="color:#a6e22e">v-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;current.set_date&#34;</span> <span style="color:#a6e22e">size</span><span style="color:#f92672">=</span><span style="color:#e6db74">5</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">v-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;current.name&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">br</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">v-on:click</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;addCurrent()&#34;</span> <span style="color:#a6e22e">v-show</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;current.status&#34;</span>&gt;Add&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- 3 piece identification --&gt;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;id-current&#34;</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">v-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;current.color&#34;</span> &gt;
</span></span><span style="display:flex;"><span>       &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#a6e22e">disabled</span> <span style="color:#a6e22e">selected</span>&gt;color&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>       &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">v-for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;g in options.color&#34;</span> <span style="color:#a6e22e">v-bind:style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{color: g}&#34;</span>&gt;{{g}}&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">v-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;current.grade_full&#34;</span> &gt;
</span></span><span style="display:flex;"><span>       &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#a6e22e">disabled</span> <span style="color:#a6e22e">selected</span>&gt;grade&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>       &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">v-for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;g in options.grade&#34;</span>&gt;{{g}}&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;plus_half&#34;</span> <span style="color:#a6e22e">v-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;current.plus_half&#34;</span> /&gt; +1/2?
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- &#34;fancier&#34; select
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    -- select grade as as radio buttons
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  &lt;ul class=&#34;color-buttons&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &lt;li v-for=&#34;c in options.color&#34; v-bind:class=&#34;{&#39;box-selected&#39;: c == current.color }&#34; v-bind:style=&#34;{ background: c}&#34; @click=&#34;current.color = c&#34; v-bind:title=&#34;c&#34; &gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &lt;/li&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  &lt;/ul&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  &lt;ul class=&#34;grade-select&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   &lt;li v-for=&#34;g in options.grade&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     &lt;input type=&#34;radio&#34; name=&#34;grade&#34; :value=&#34;g&#34; v-model=&#34;current.grade_full&#34; /&gt;&lt;br/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    {{g}} 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     &lt;/li&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   &lt;li&gt;&lt;input type=&#34;checkbox&#34; name=&#34;plus_half&#34; v-model=&#34;current.plus_half&#34; /&gt; &lt;br /&gt; +1/2?&lt;/li&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  &lt;/ul&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  --&gt;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;climbingAreas&#34;</span>&gt; &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!--  summary list --&gt;</span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;route_list&#34;</span>&gt; 
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">v-for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;r in route_summaries&#34;</span>  <span style="color:#a6e22e">v-if</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;matches_current(r)&#34;</span>&gt; 
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">v-on:click</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;setCurrent(r)&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;info&#34;</span>&gt;
</span></span><span style="display:flex;"><span>       {{r.area}} {{r.color}} {{r.grade}} 
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">span</span>&gt; 
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">br</span> /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;info_minor&#34;</span>&gt;
</span></span><span style="display:flex;"><span>       {{r.name}} {{r.setter}} {{r.set_date}}
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stats&#34;</span>&gt; 
</span></span><span style="display:flex;"><span>       | {{r.cnt}} {{r.avgrank}} ( {{r.recent}} )
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">hr</span> <span style="color:#a6e22e">v-show</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;allroutes.length &gt; 0&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!--  raw list --&gt;</span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;route_list&#34;</span>&gt; 
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">v-for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;r in allroutes&#34;</span>&gt; 
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">v-on:click</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;setCurrent(r)&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;info&#34;</span>&gt;
</span></span><span style="display:flex;"><span>       {{r.area}} {{r.color}} {{r.grade}} 
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">span</span>&gt;  &lt;<span style="color:#f92672">br</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;person&#34;</span>&gt; 
</span></span><span style="display:flex;"><span>       {{r.climber}} {{r.status}} @ {{r.timestamp}}
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- d3 select area --&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;climbarea.js&#34;</span>&gt; &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;</span></span></code></pre></div>
</div>
<div id="outline-container-headline-7" class="outline-4">
<h4 id="headline-7">
style
</h4>
<div id="outline-text-headline-7" class="outline-text-4">
<div class="src src-css">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>.<span style="color:#a6e22e">clickable</span> { <span style="color:#66d9ef">cursor</span>: <span style="color:#66d9ef">pointer</span>;  }
</span></span><span style="display:flex;"><span>#current { <span style="color:#66d9ef">border</span>: <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">black</span> <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span>; <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span>;}
</span></span><span style="display:flex;"><span>#id-current {<span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">em</span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* ul/li setting for color buttons is the only real meaningful css setting 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * all other elements will display in a functioning way with css */</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">ul</span> { 
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">list-style</span>: <span style="color:#66d9ef">none</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">grade-select</span> <span style="color:#f92672">&gt;</span><span style="color:#f92672">li</span> { <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">inline-block</span>; <span style="color:#66d9ef">text-align</span>:<span style="color:#66d9ef">center</span>}
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">color-buttons</span><span style="color:#f92672">&gt;</span><span style="color:#f92672">li</span> { 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">inline-block</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">20</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">height</span>:<span style="color:#ae81ff">20</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">margin-right</span>: <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">border</span>: <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">black</span> <span style="color:#ae81ff">2</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">cursor</span>: <span style="color:#66d9ef">pointer</span>; }
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">box-selected</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">border-color</span>: <span style="color:#66d9ef">red</span> <span style="color:#75715e">!important</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* left side */</span>
</span></span><span style="display:flex;"><span>#route_specification {
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">inline-block</span>;
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">400</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#current <span style="color:#f92672">&gt;</span> <span style="color:#f92672">span</span>.<span style="color:#a6e22e">route_id</span> {
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">block</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* right side */</span>
</span></span><span style="display:flex;"><span>#list {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">inline-block</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vertical-align</span>: <span style="color:#66d9ef">top</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* display submited route statuses */</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">ul</span>.<span style="color:#a6e22e">route_list</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">li</span> {
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">.2</span><span style="color:#66d9ef">em</span>;
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">padding-bottom</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">em</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">ul</span>.<span style="color:#a6e22e">route_list</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">li</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">span</span>.<span style="color:#a6e22e">info</span> {
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">background-color</span>: <span style="color:#66d9ef">lightblue</span>;
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">margin-right</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">em</span>;
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">cursor</span>: <span style="color:#66d9ef">pointer</span>;
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">margin-bottom</span>: <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">darkblue</span> <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">border-bottom</span>: <span style="color:#66d9ef">dashed</span> <span style="color:#66d9ef">black</span> <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">ul</span>.<span style="color:#a6e22e">route_list</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">li</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">span</span>.<span style="color:#a6e22e">info</span>:<span style="color:#a6e22e">hover</span><span style="color:#f92672">,</span> <span style="color:#f92672">ul</span>.<span style="color:#a6e22e">route_list</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">li</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">span</span>.<span style="color:#a6e22e">info</span>:<span style="color:#a6e22e">active</span> {
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">background-color</span>: <span style="color:#66d9ef">lightgreen</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">ul</span>.<span style="color:#a6e22e">route_list</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">li</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">span</span>.<span style="color:#a6e22e">person</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">6</span><span style="color:#66d9ef">pt</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">background-color</span>: <span style="color:#66d9ef">gray</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">border-radius</span>: <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">border</span>: <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">black</span> <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">.2</span><span style="color:#66d9ef">em</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
model-view
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<div id="outline-container-headline-9" class="outline-4">
<h4 id="headline-9">
model
</h4>
<div id="outline-text-headline-9" class="outline-text-4">
<p>what do we want to track, what color, grade, and status options are allowed</p>
<div class="src src-javascript">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">empty_route_info</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;area&#39;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;set_date&#39;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;setter&#39;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;name&#39;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span> <span style="color:#75715e">//status and rate are dropdowns
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> <span style="color:#75715e">// must be &#34;&#34; instead of null so dropbox selects it
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> <span style="color:#e6db74">&#39;grade_full&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>, 
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;status&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>, 
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;rate&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;color&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>, 
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;note&#39;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;location&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;TCW_boulder&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;climber&#39;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">model</span> <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span> {<span style="color:#e6db74">&#39;current&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">empty_route_info</span>)),
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;options&#39;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;status&#39;</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;on-sight&#39;</span>,<span style="color:#e6db74">&#39;completed&#39;</span>,<span style="color:#e6db74">&#39;peiced&#39;</span>,<span style="color:#e6db74">&#39;75%&#39;</span>,<span style="color:#e6db74">&#39;50%&#39;</span>,<span style="color:#e6db74">&#39;25%&#39;</span>,<span style="color:#e6db74">&#39;started&#39;</span>,<span style="color:#e6db74">&#39;skipped&#39;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;color&#39;</span><span style="color:#f92672">:</span>  [<span style="color:#e6db74">&#39;red&#39;</span>,<span style="color:#e6db74">&#39;orange&#39;</span>,<span style="color:#e6db74">&#39;yellow&#39;</span>,<span style="color:#e6db74">&#39;green&#39;</span>,<span style="color:#e6db74">&#39;blue&#39;</span>,<span style="color:#e6db74">&#39;pink&#39;</span>,<span style="color:#e6db74">&#39;black&#39;</span>,<span style="color:#e6db74">&#39;white&#39;</span>,<span style="color:#e6db74">&#39;stripped&#39;</span>,<span style="color:#e6db74">&#39;rainbow&#39;</span>,<span style="color:#e6db74">&#39;graphic&#39;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;grade&#39;</span><span style="color:#f92672">:</span>  [<span style="color:#e6db74">&#39;B&#39;</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">8</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;ratings&#39;</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// left side lists of routes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#e6db74">&#39;allroutes&#39;</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;route_summaries&#39;</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span> }</span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-10" class="outline-4">
<h4 id="headline-10">
View (and send)
</h4>
<div id="outline-text-headline-10" class="outline-text-4">
<p>Vue does the heaving lifting. define two functions</p>
<ul>
<li>grade_combined to change B to -1 and add the half grade</li>
<li>addCurrent to send away the selection+status</li>
</ul>
<div class="src src-javascript">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sendaway</span>(<span style="color:#a6e22e">data</span>) {
</span></span><span style="display:flex;"><span>     <span style="color:#75715e">//console.log(&#39;sending&#39;,data)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>     <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>()
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#39;POST&#39;</span>,<span style="color:#e6db74">&#39;/add&#39;</span>,<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">setRequestHeader</span>(<span style="color:#e6db74">&#34;Content-type&#34;</span>,<span style="color:#e6db74">&#34;application/json&#34;</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">ajax_update</span>(<span style="color:#a6e22e">path</span>,<span style="color:#a6e22e">onready</span>){
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>()
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">onreadystatechange</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">readyState</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>){
</span></span><span style="display:flex;"><span>           <span style="color:#a6e22e">onready</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">response</span>))
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#39;GET&#39;</span>,<span style="color:#a6e22e">path</span>,<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#75715e">//x.setRequestHeader(&#34;Content-type&#34;,&#34;application/json&#34;) // overrideMimeType
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>     <span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">send</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// format a date field in a list of hashes/dicts
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// from python datetime
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">frmt_date</span>(<span style="color:#a6e22e">a</span>,<span style="color:#a6e22e">field</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span>( <span style="color:#f92672">!</span> <span style="color:#a6e22e">a</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">field</span>] ) { <span style="color:#66d9ef">continue</span> }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date(<span style="color:#a6e22e">a</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">field</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">a</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">field</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">toISOString</span>().<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">16</span>).<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#39;T&#39;</span>,<span style="color:#e6db74">&#39; &#39;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>(<span style="color:#a6e22e">a</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isempty</span>(<span style="color:#a6e22e">x</span>){ <span style="color:#66d9ef">return</span>( <span style="color:#a6e22e">x</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">undefined</span>) }
</span></span><span style="display:flex;"><span><span style="color:#75715e">// for filtering. return true when not set, or when matches
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">null_or_match</span>(<span style="color:#a6e22e">x</span>,<span style="color:#a6e22e">m</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span>( <span style="color:#a6e22e">x</span> <span style="color:#f92672">!==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isempty</span>(<span style="color:#a6e22e">x</span>) ) {
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">return</span>(<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span>(<span style="color:#a6e22e">x</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">m</span>) 
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">vueControler</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Vue</span>({
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">el</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;#climbing_spa&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">model</span>, 
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">computed</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">//current_grade: this.grade_combined
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#a6e22e">current_grade</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(){
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">grade</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">grade_full</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;B&#39;</span> <span style="color:#f92672">?</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> parseInt(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">grade_full</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#75715e">//console.log(&#39;current_grade computed:&#39;,this.current.grade_full,grade,isNaN(grade))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>     <span style="color:#66d9ef">if</span>(isNaN(<span style="color:#a6e22e">grade</span>)){ <span style="color:#66d9ef">return</span>(<span style="color:#66d9ef">null</span>) }
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">grade</span> <span style="color:#f92672">+</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">plus_half</span> <span style="color:#f92672">?</span> .<span style="color:#ae81ff">5</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>) )
</span></span><span style="display:flex;"><span>   },
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">have_any_current</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">isempty</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">area</span>)  <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">!</span><span style="color:#a6e22e">isempty</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">color</span>) <span style="color:#f92672">||</span> 
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">!</span><span style="color:#a6e22e">isempty</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current_grade</span>) )
</span></span><span style="display:flex;"><span>   },
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">have_all_current</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">isempty</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">area</span>)  <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">!</span><span style="color:#a6e22e">isempty</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">color</span>) <span style="color:#f92672">&amp;&amp;</span> 
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">!</span><span style="color:#a6e22e">isempty</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current_grade</span>) )
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> },
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">methods</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">setClimber</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">climber</span>){
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">climber</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> ){
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">climber</span> <span style="color:#f92672">=</span>  <span style="color:#a6e22e">prompt</span>(<span style="color:#e6db74">&#39;Who are you?&#39;</span>)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">empty_route_info</span>[<span style="color:#e6db74">&#39;climber&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">climber</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">climber</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">empty_route_info</span>[<span style="color:#e6db74">&#39;climber&#39;</span>]
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// set cookie
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      document.<span style="color:#a6e22e">cookie</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;max-age=31536000&#34;</span>
</span></span><span style="display:flex;"><span>      document.<span style="color:#a6e22e">cookie</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;climber=&#34;</span><span style="color:#f92672">+</span> <span style="color:#a6e22e">climber</span>
</span></span><span style="display:flex;"><span>   },
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">matches_current</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">r</span>){
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e">//console.log(&#39;match current? r:&#39;,JSON.stringify(r),&#39; current:&#39;,JSON.stringify(this.current))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>     <span style="color:#66d9ef">return</span>( <span style="color:#a6e22e">null_or_match</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">color</span>,<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">color</span>) <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">null_or_match</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current_grade</span>,<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">grade</span>) <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">null_or_match</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">area</span>, <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">area</span>) )
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>   },
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">grade_combined</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(){
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">return</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current_grade</span>)
</span></span><span style="display:flex;"><span>   },
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">setCurrent</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">r</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;setCurrent&#39;</span>,<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">r</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">color</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">color</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">area</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">area</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">name</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">setter</span> <span style="color:#f92672">=</span>  <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">setter</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">area_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;#area_&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">area</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// this calls to var and function created later by d3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">svgdiv</span>.<span style="color:#a6e22e">select</span>(<span style="color:#a6e22e">area_id</span>).<span style="color:#a6e22e">each</span>(<span style="color:#a6e22e">select_area</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// grade_full is without the .5, and B if -1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">newgrade</span> <span style="color:#f92672">=</span> parseFloat(<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">grade</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(isNaN(<span style="color:#a6e22e">newgrade</span>)){<span style="color:#a6e22e">newgrade</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//console.log(&#39;setCurrent grade from-&gt;to:&#39;,this.current.grade_full, r.grade, newgrade)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span>( <span style="color:#a6e22e">newgrade</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> ){
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">grade_full</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;B&#34;</span>
</span></span><span style="display:flex;"><span>    }<span style="color:#66d9ef">else</span> {   
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">grade_full</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(<span style="color:#a6e22e">newgrade</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// update half point checkbox
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">newplushalf</span><span style="color:#f92672">=</span>(<span style="color:#a6e22e">newgrade</span> <span style="color:#f92672">!=</span> Math.<span style="color:#a6e22e">floor</span>(<span style="color:#a6e22e">newgrade</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//console.log(&#39;setCurrent half old,new: &#39;,this.current.plus_half, newplushalf)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">plus_half</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newplushalf</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// research all logs of this 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">listURL</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;list&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">location</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">area</span>,<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">color</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current_grade</span>].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ajax_update</span>(<span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">listURL</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">fetchAllstatuses</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;updated allroutes&#39;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">allroutes</span>)
</span></span><span style="display:flex;"><span>   },
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">addCurrent</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(){
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">grade</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">grade_combined</span>()
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">sendaway</span>(<span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#75715e">// update view to empyt state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>     <span style="color:#75715e">// TODO: maybe keep
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>     <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">updateList</span>()
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">reset_current</span>()
</span></span><span style="display:flex;"><span>   },
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// cannot use until page is loaded because reset color defied later
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#75715e">// means we code copy of empty_route_info twice
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#a6e22e">reset_current</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(){
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">empty_route_info</span>))
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">reset_color</span>()
</span></span><span style="display:flex;"><span>   },
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">updateList</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;update summary&#39;</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#75715e">// all routes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>     <span style="color:#a6e22e">ajax_update</span>(<span style="color:#e6db74">&#39;/summary/&#39;</span><span style="color:#f92672">+</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">location</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">fetchClimbSummaries</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e">// all statuses
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>     <span style="color:#75715e">// ajax_update(&#39;/list/&#39;+this.current.location, this.fetchAllstatuses)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   },
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/* get data from api server */</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">fetchAllstatuses</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">d</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">self</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">d</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">allroutes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">frmt_date</span>(<span style="color:#a6e22e">d</span>,<span style="color:#e6db74">&#39;timestamp&#39;</span>)
</span></span><span style="display:flex;"><span>   },
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">fetchClimbSummaries</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">d</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">self</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">d</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// clean up: unixtimestamp to iso date
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">route_summaries</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">frmt_date</span>(<span style="color:#a6e22e">d</span>,<span style="color:#e6db74">&#39;recent&#39;</span>)
</span></span><span style="display:flex;"><span>   },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> },
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">mounted</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(){
</span></span><span style="display:flex;"><span>     <span style="color:#75715e">//console.log(&#39;mounting&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>     <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">updateList</span>()
</span></span><span style="display:flex;"><span>     <span style="color:#75715e">// use cookie or prompt for climber(user)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>     <span style="color:#75715e">// should match climber=MY_CLIMBING_ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>     <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;setting cookie&#39;</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">m</span><span style="color:#f92672">=</span>decodeURIComponent(document.<span style="color:#a6e22e">cookie</span>).<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">&#39;climber=([^;]+)&#39;</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">climber</span><span style="color:#f92672">=</span><span style="color:#a6e22e">m</span><span style="color:#f92672">?</span><span style="color:#a6e22e">m</span>[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">:</span><span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setClimber</span>(<span style="color:#a6e22e">climber</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;climber = &#39;</span>,<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">climber</span>,<span style="color:#e6db74">&#39;; should be:&#39;</span>, <span style="color:#a6e22e">climber</span>)
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>})</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-11" class="outline-3">
<h3 id="headline-11">
selecting areas
</h3>
<div id="outline-text-headline-11" class="outline-text-3">
<p>We want to click an area. This depends on the svg floor plan loaded later.</p>
<div class="src src-javascript">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// setup
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//var svgdiv = d3.select(&#34;body&#34;).append(&#34;div&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//svgdiv.attr(&#34;id&#34;,&#34;climbingAreas&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">svgdiv</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">select</span>(<span style="color:#e6db74">&#34;div#climbingAreas&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">svg</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">clickable</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">reset_color</span>() {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">clickable</span>.<span style="color:#a6e22e">each</span>( <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">select</span>(<span style="color:#66d9ef">this</span>).<span style="color:#a6e22e">style</span>(<span style="color:#e6db74">&#39;fill&#39;</span>,<span style="color:#e6db74">&#39;green&#39;</span>)  
</span></span><span style="display:flex;"><span> })
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">select_area</span>() {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">reset_color</span>()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">area</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">select</span>(<span style="color:#66d9ef">this</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">area</span>.<span style="color:#a6e22e">style</span>(<span style="color:#e6db74">&#39;fill&#39;</span>,<span style="color:#e6db74">&#39;red&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">area</span>.<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;id&#39;</span>).<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/area_(.*)/</span>)[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">area</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">name</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">name</span>)
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-12" class="outline-3">
<h3 id="headline-12">
inserting svg and area clicks
</h3>
<div id="outline-text-headline-12" class="outline-text-3">
<p>The floor plan for the boldering area has already been created as an svg.
 <code>rect</code> and <code>path</code> svg elements define areas that will contain routes and have an ID starting with <code>area_</code>.</p>
<div class="src src-javascript">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e">// inject svg, define clickable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">xml</span>(<span style="color:#e6db74">&#34;outline.svg&#34;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">error</span>, <span style="color:#a6e22e">documentFragment</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">error</span>) {<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">error</span>); <span style="color:#66d9ef">return</span>;}
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">svgdiv</span>.<span style="color:#a6e22e">node</span>().<span style="color:#a6e22e">appendChild</span>(
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">documentFragment</span>.<span style="color:#a6e22e">getElementsByTagName</span>(<span style="color:#e6db74">&#34;svg&#34;</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">svg</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">svgdiv</span>.<span style="color:#a6e22e">select</span>(<span style="color:#e6db74">&#34;svg&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// shrink 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">svg</span>.<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#34;width&#34;</span>, <span style="color:#e6db74">&#34;400&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">svg</span>.<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#34;height&#34;</span>, <span style="color:#e6db74">&#34;250&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">allpaths</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">svg</span>.<span style="color:#a6e22e">selectAll</span>(<span style="color:#e6db74">&#39;path,rect&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">clickable</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">allpaths</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">select</span>(<span style="color:#66d9ef">this</span>).<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;id&#39;</span>)
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">return</span>( <span style="color:#a6e22e">id</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">id</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/area/</span>) <span style="color:#f92672">!==</span> <span style="color:#66d9ef">null</span> ) 
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>           
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">clickable</span>.<span style="color:#a6e22e">each</span>( <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">p</span><span style="color:#f92672">=</span><span style="color:#a6e22e">d3</span>.<span style="color:#a6e22e">select</span>(<span style="color:#66d9ef">this</span>)
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">style</span>(<span style="color:#e6db74">&#39;cursor&#39;</span>,<span style="color:#e6db74">&#39;pointer&#39;</span>)
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;click&#39;</span>,<span style="color:#a6e22e">select_area</span>)
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    });</span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-13" class="outline-3">
<h3 id="headline-13">
Server
</h3>
<div id="outline-text-headline-13" class="outline-text-3">
<p>We want to log this persistent. It&#39;d be cool to compare to others too. First lets just get recording working.
<a href="http://localhost:8080/index.html">http://localhost:8080/index.html</a></p>
<div id="outline-container-headline-14" class="outline-4">
<h4 id="headline-14">
testing the server
</h4>
<div id="outline-text-headline-14" class="outline-text-4">
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>data<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{&#34;color&#34;: &#34;red&#34;, &#34;grade&#34;: 3, 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;area&#34;: &#34;45&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;status&#34;: &#34;completed&#34;, &#34;rate&#34;: 4,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;note&#34;: &#34;fun&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;location&#34;: &#34;TCW_boulder&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;climber&#34;: &#34;WF&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   }&#39;</span>
</span></span><span style="display:flex;"><span>http POST http://localhost:8080/add Content-type:application/json <span style="color:#f92672">&lt;&lt;&lt;</span><span style="color:#e6db74">&#34;</span>$data<span style="color:#e6db74">&#34;</span></span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-15" class="outline-4">
<h4 id="headline-15">
quick API
</h4>
<div id="outline-text-headline-15" class="outline-text-4">
<p>Written with bottle. Statically serving other files.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>  <span style="color:#75715e">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># (elpy-use-ipython)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">from</span> bottle <span style="color:#f92672">import</span> route, run, post, static_file, request, response
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">from</span> tinydb <span style="color:#f92672">import</span> TinyDB, Query
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">import</span> datetime
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">from</span> climb_summary <span style="color:#f92672">import</span> climb_summary
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  db <span style="color:#f92672">=</span> TinyDB(<span style="color:#e6db74">&#39;./climbing_status.json&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@route</span>(<span style="color:#e6db74">&#39;/add&#39;</span>,method<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;POST&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add</span>():
</span></span><span style="display:flex;"><span>      data <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span>      data[<span style="color:#e6db74">&#39;timestamp&#39;</span>] <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>now()<span style="color:#f92672">.</span>timestamp()
</span></span><span style="display:flex;"><span>      print(data)
</span></span><span style="display:flex;"><span>      db<span style="color:#f92672">.</span>insert(data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># just list all statuses from a location</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@route</span>(<span style="color:#e6db74">&#39;/list/&lt;location&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">list</span>(location<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;TCW_boulder&#34;</span>):
</span></span><span style="display:flex;"><span>      q <span style="color:#f92672">=</span> Query()
</span></span><span style="display:flex;"><span>      r <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span>search(q<span style="color:#f92672">.</span>location <span style="color:#f92672">==</span> location)
</span></span><span style="display:flex;"><span>      response<span style="color:#f92672">.</span>content_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;application/json&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>dumps(r)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># list summary for a location</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@route</span>(<span style="color:#e6db74">&#39;/summary&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@route</span>(<span style="color:#e6db74">&#39;/summary/&lt;location&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@route</span>(<span style="color:#e6db74">&#39;/summary/&lt;location&gt;/&lt;sortby&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">list</span>(location<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;TCW_boulder&#34;</span>,sortby<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cnt&#34;</span>):
</span></span><span style="display:flex;"><span>      q <span style="color:#f92672">=</span> Query()
</span></span><span style="display:flex;"><span>      r <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span>search(q<span style="color:#f92672">.</span>location <span style="color:#f92672">==</span> location)
</span></span><span style="display:flex;"><span>      s <span style="color:#f92672">=</span> climb_summary(r,sortby)
</span></span><span style="display:flex;"><span>      response<span style="color:#f92672">.</span>content_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;application/json&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>dumps(s)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># specific route information</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@route</span>(<span style="color:#e6db74">&#39;/list/&lt;location&gt;/&lt;area&gt;/&lt;color&gt;/&lt;grade&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@route</span>(<span style="color:#e6db74">&#39;/list/&lt;location&gt;/&lt;area&gt;/&lt;color&gt;/&lt;grade&gt;/&lt;sortby&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">list</span>(location,area,color,grade,sortby<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cnt&#34;</span>):
</span></span><span style="display:flex;"><span>      q <span style="color:#f92672">=</span> Query()
</span></span><span style="display:flex;"><span>      r <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span>search( (q<span style="color:#f92672">.</span>location <span style="color:#f92672">==</span> location) <span style="color:#f92672">&amp;</span> (q<span style="color:#f92672">.</span>area <span style="color:#f92672">==</span> area) <span style="color:#f92672">&amp;</span>
</span></span><span style="display:flex;"><span>                     (q<span style="color:#f92672">.</span>color <span style="color:#f92672">==</span> color) <span style="color:#f92672">&amp;</span> (q<span style="color:#f92672">.</span>grade <span style="color:#f92672">==</span> float(grade)) )
</span></span><span style="display:flex;"><span>      response<span style="color:#f92672">.</span>content_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;application/json&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#print(&#39;looking for loc &#34;%s&#34; area &#34;%s&#34; color &#34;%s&#34; grade &#34;%s&#34;&#39; % (location, area, color, grade) )</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#print(&#34;found %d&#34; % len(r))</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#s = climb_summary(r,sortby)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>dumps(r)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># all filenames are static</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@route</span>(<span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@route</span>(<span style="color:#e6db74">&#39;/&lt;filename&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">static_f</span>(filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;index.html&#39;</span>):
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span>(static_file(filename, root<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  run(host<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;0.0.0.0&#39;</span>,port<span style="color:#f92672">=</span><span style="color:#ae81ff">8080</span>)</span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-16" class="outline-4">
<h4 id="headline-16">
supporting functions
</h4>
<div id="outline-text-headline-16" class="outline-text-4">
<p>this file exists to summarize the list of climbing statuses 
    the heavy lifting is done by <code>try_fill</code> which is a bad attempt at merging under specified climbing routes within a status to fully specified routes.
    no attempt is made to merge non-overlapping partials.
    set date is still ignored</p>
<div id="outline-container-headline-17" class="outline-5">
<h5 id="headline-17">
<span class="todo">TODO</span>
add set date to <code>try_fill</code> and friends
</h5>
<div id="outline-text-headline-17" class="outline-text-5">
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>   <span style="color:#f92672">from</span> itertools <span style="color:#f92672">import</span> groupby
</span></span><span style="display:flex;"><span>   <span style="color:#75715e"># helper functions</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">groupinfo</span>(itera):
</span></span><span style="display:flex;"><span>       <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       :param itera: array iterator of climbing route dicts from groupby
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       :returns: (dict) with summary stats for that group 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>       a <span style="color:#f92672">=</span> list(itera)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#75715e"># rank calc requries a filter</span>
</span></span><span style="display:flex;"><span>       <span style="color:#75715e"># mabye worth importing numpy</span>
</span></span><span style="display:flex;"><span>       ranks <span style="color:#f92672">=</span> list(filter( <span style="color:#66d9ef">lambda</span> x: x <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>, [x<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;rank&#39;</span>,<span style="color:#66d9ef">None</span>) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> a]))
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">if</span> len(ranks) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>           avgrank <span style="color:#f92672">=</span> sum(ranks)<span style="color:#f92672">/</span>len(ranks)
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>           avgrank <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       d <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#39;cnt&#39;</span>: len(a),
</span></span><span style="display:flex;"><span>             <span style="color:#e6db74">&#39;recent&#39;</span>: max([<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> [x<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;timestamp&#39;</span>,<span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> a]),
</span></span><span style="display:flex;"><span>             <span style="color:#e6db74">&#39;avgrank&#39;</span>: avgrank,
</span></span><span style="display:flex;"><span>           }
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">return</span>(d)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">climb_summary</span>(r,sortby<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;cnt&#39;</span>):
</span></span><span style="display:flex;"><span>       header<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;location&#39;</span>,<span style="color:#e6db74">&#39;area&#39;</span>,<span style="color:#e6db74">&#39;color&#39;</span>,<span style="color:#e6db74">&#39;grade&#39;</span>,<span style="color:#e6db74">&#39;setter&#39;</span>,<span style="color:#e6db74">&#39;name&#39;</span>]
</span></span><span style="display:flex;"><span>       g <span style="color:#f92672">=</span> groupby(r,<span style="color:#66d9ef">lambda</span> x: [x<span style="color:#f92672">.</span>get(k) <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> header] )
</span></span><span style="display:flex;"><span>       <span style="color:#75715e"># summarise all status into count and recent</span>
</span></span><span style="display:flex;"><span>       s <span style="color:#f92672">=</span> [{<span style="color:#e6db74">&#39;info&#39;</span>: k,
</span></span><span style="display:flex;"><span>             ,<span style="color:#f92672">**</span>groupinfo(a),
</span></span><span style="display:flex;"><span>             <span style="color:#75715e"># nfilled is the number of good values we have</span>
</span></span><span style="display:flex;"><span>             <span style="color:#e6db74">&#39;nfilled&#39;</span>: int(k[header<span style="color:#f92672">.</span>index(<span style="color:#e6db74">&#39;setter&#39;</span>)] <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#66d9ef">None</span>, <span style="color:#e6db74">&#34;&#34;</span>]) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                        int(k[header<span style="color:#f92672">.</span>index(<span style="color:#e6db74">&#39;name&#39;</span>)] <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#66d9ef">None</span>,<span style="color:#e6db74">&#34;&#34;</span>])
</span></span><span style="display:flex;"><span>             } <span style="color:#66d9ef">for</span> k, a <span style="color:#f92672">in</span> g]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#75715e"># break back into array of dict</span>
</span></span><span style="display:flex;"><span>       d <span style="color:#f92672">=</span> [ {
</span></span><span style="display:flex;"><span>             <span style="color:#75715e"># put back info as dict</span>
</span></span><span style="display:flex;"><span>             ,<span style="color:#f92672">**</span>{k: v <span style="color:#66d9ef">for</span> k,v <span style="color:#f92672">in</span> zip(header,x[<span style="color:#e6db74">&#39;info&#39;</span>])},
</span></span><span style="display:flex;"><span>             <span style="color:#75715e"># also add any other stats that we computed</span>
</span></span><span style="display:flex;"><span>             <span style="color:#75715e"># skip &#39;info&#39; </span>
</span></span><span style="display:flex;"><span>             ,<span style="color:#f92672">**</span>{k: x[k] <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> x <span style="color:#66d9ef">if</span> k <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;info&#39;</span>]}
</span></span><span style="display:flex;"><span>           } <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> s]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#75715e"># re-group to merge where setter or name is empty</span>
</span></span><span style="display:flex;"><span>       <span style="color:#75715e"># maybe we should do this will pandas forwardfill fillna </span>
</span></span><span style="display:flex;"><span>       d <span style="color:#f92672">=</span> fill_idna(d)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#75715e"># sort</span>
</span></span><span style="display:flex;"><span>       s <span style="color:#f92672">=</span> sorted(d, key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> x: x[sortby] )
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">return</span>(d)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e"># this is absolutely misguided</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e"># for a group of climbing dictionaries</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e"># that all have the same loc,area,color, and grade</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e"># match setter and name when we can</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e"># might do terrible things when have only partial info for more than one climb</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">try_fill</span>(itera):
</span></span><span style="display:flex;"><span>       <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       example
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       -------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       itera = [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       {&#39;nfilled&#39;: 2, &#39;setter&#39;: &#39;ab&#39;, &#39;name&#39;: &#39;xx&#39;, &#39;avgrank&#39;: 3, &#39;cnt&#39;: 10, &#39;recent&#39;: 9}, 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       {&#39;nfilled&#39;: 1, &#39;setter&#39;: &#39;ab&#39;, &#39;name&#39;: &#39;&#39;, &#39;avgrank&#39;: 1, &#39;cnt&#39;: 2, &#39;recent&#39;: 0},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       {&#39;nfilled&#39;: 1, &#39;setter&#39;: &#39;&#39;, &#39;name&#39;: &#39;xx&#39;, &#39;avgrank&#39;: 5, &#39;cnt&#39;: 1, &#39;recent&#39;: 10}]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>       a_sorted <span style="color:#f92672">=</span> sorted(itera,key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> x: <span style="color:#f92672">-</span>x<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;nfilled&#39;</span>,<span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       matching <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;setter&#39;</span>,<span style="color:#e6db74">&#39;name&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#75715e"># build truth</span>
</span></span><span style="display:flex;"><span>       truth <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">while</span> len(a_sorted) <span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> a_sorted[<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;nfilled&#39;</span>] <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>           truth<span style="color:#f92672">.</span>append( a_sorted<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>) )
</span></span><span style="display:flex;"><span>       <span style="color:#75715e"># compare the rest to the truth</span>
</span></span><span style="display:flex;"><span>       <span style="color:#75715e"># add together if matches</span>
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">for</span> ti <span style="color:#f92672">in</span> range(len(truth)):
</span></span><span style="display:flex;"><span>         t <span style="color:#f92672">=</span> truth[ti]
</span></span><span style="display:flex;"><span>         a_keep <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">for</span> ai <span style="color:#f92672">in</span> range(len(a_sorted)):
</span></span><span style="display:flex;"><span>             a <span style="color:#f92672">=</span> a_sorted[ai]
</span></span><span style="display:flex;"><span>             nmatches <span style="color:#f92672">=</span> sum([ int(t<span style="color:#f92672">.</span>get(i) <span style="color:#f92672">==</span> a<span style="color:#f92672">.</span>get(i) <span style="color:#f92672">and</span> t<span style="color:#f92672">.</span>get(i) <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> matching])
</span></span><span style="display:flex;"><span>             <span style="color:#75715e"># if we matched all the good parts of our partially emtpy dict</span>
</span></span><span style="display:flex;"><span>             <span style="color:#75715e"># update truth with this count and remove from a</span>
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">if</span> nmatches <span style="color:#f92672">==</span> a[<span style="color:#e6db74">&#39;nfilled&#39;</span>]:
</span></span><span style="display:flex;"><span>                 truth[ti][<span style="color:#e6db74">&#39;recent&#39;</span>] <span style="color:#f92672">=</span> max(t[<span style="color:#e6db74">&#39;recent&#39;</span>],a[<span style="color:#e6db74">&#39;recent&#39;</span>])
</span></span><span style="display:flex;"><span>                 truth[ti][<span style="color:#e6db74">&#39;cnt&#39;</span>] <span style="color:#f92672">=</span> t[<span style="color:#e6db74">&#39;cnt&#39;</span>]<span style="color:#f92672">+</span>a[<span style="color:#e6db74">&#39;cnt&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                 <span style="color:#75715e"># deal with null avgrank</span>
</span></span><span style="display:flex;"><span>                 cnt<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#66d9ef">if</span> t[<span style="color:#e6db74">&#39;avgrank&#39;</span>]:
</span></span><span style="display:flex;"><span>                    tavg <span style="color:#f92672">=</span> t[<span style="color:#e6db74">&#39;cnt&#39;</span>]<span style="color:#f92672">*</span>t[<span style="color:#e6db74">&#39;avgrank&#39;</span>] 
</span></span><span style="display:flex;"><span>                    cnt <span style="color:#f92672">=</span> t[<span style="color:#e6db74">&#39;cnt&#39;</span>]
</span></span><span style="display:flex;"><span>                 <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    tavg <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#66d9ef">if</span> a[<span style="color:#e6db74">&#39;avgrank&#39;</span>]:
</span></span><span style="display:flex;"><span>                    aavg <span style="color:#f92672">=</span> a[<span style="color:#e6db74">&#39;cnt&#39;</span>]<span style="color:#f92672">*</span>a[<span style="color:#e6db74">&#39;avgrank&#39;</span>] 
</span></span><span style="display:flex;"><span>                    cnt <span style="color:#f92672">=</span> cnt <span style="color:#f92672">+</span> t[<span style="color:#e6db74">&#39;cnt&#39;</span>]
</span></span><span style="display:flex;"><span>                 <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    aavg<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                 
</span></span><span style="display:flex;"><span>                 truth[ti][<span style="color:#e6db74">&#39;avgrank&#39;</span>] <span style="color:#f92672">=</span> (tavg <span style="color:#f92672">+</span> aavg)<span style="color:#f92672">/</span>cnt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                 a_keep<span style="color:#f92672">.</span>append(ai)
</span></span><span style="display:flex;"><span>         a_sorted <span style="color:#f92672">=</span> [a_sorted[i] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> a_keep]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">return</span>(truth <span style="color:#f92672">+</span> a_sorted)
</span></span><span style="display:flex;"><span>              
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fill_idna</span>(d):
</span></span><span style="display:flex;"><span>       header <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;location&#39;</span>,<span style="color:#e6db74">&#39;area&#39;</span>,<span style="color:#e6db74">&#39;color&#39;</span>,<span style="color:#e6db74">&#39;grade&#39;</span>]
</span></span><span style="display:flex;"><span>       g <span style="color:#f92672">=</span> groupby(d, <span style="color:#66d9ef">lambda</span> x: [x<span style="color:#f92672">.</span>get(h) <span style="color:#66d9ef">for</span> h <span style="color:#f92672">in</span>  header])
</span></span><span style="display:flex;"><span>       m <span style="color:#f92672">=</span> [ {
</span></span><span style="display:flex;"><span>              <span style="color:#75715e"># header as dict</span>
</span></span><span style="display:flex;"><span>              ,<span style="color:#f92672">**</span>{k:v <span style="color:#66d9ef">for</span> k,v <span style="color:#f92672">in</span> zip(header,i)},
</span></span><span style="display:flex;"><span>              <span style="color:#75715e"># and merged (and leftovers) for this id</span>
</span></span><span style="display:flex;"><span>              ,<span style="color:#f92672">**</span>x} 
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">for</span> i, a <span style="color:#f92672">in</span> g
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> try_fill(a) ]
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">return</span>(m)
</span></span><span style="display:flex;"><span>       
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">to_df_fill</span>(r):
</span></span><span style="display:flex;"><span>    df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(r)<span style="color:#f92672">.</span>\
</span></span><span style="display:flex;"><span>         assign(nrate<span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x: x<span style="color:#f92672">.</span>rank <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>)<span style="color:#f92672">.</span>\
</span></span><span style="display:flex;"><span>         groupby([<span style="color:#e6db74">&#39;location&#39;</span>,<span style="color:#e6db74">&#39;area&#39;</span>,<span style="color:#e6db74">&#39;color&#39;</span>,<span style="color:#e6db74">&#39;grade&#39;</span>])<span style="color:#f92672">.</span>\
</span></span><span style="display:flex;"><span>         aggregate(
</span></span><span style="display:flex;"><span>          {<span style="color:#e6db74">&#39;timestamp&#39;</span>: <span style="color:#e6db74">&#39;max&#39;</span>,
</span></span><span style="display:flex;"><span>           <span style="color:#e6db74">&#39;climber&#39;</span>: <span style="color:#66d9ef">lambda</span> x: x<span style="color:#f92672">.</span>size,
</span></span><span style="display:flex;"><span>           <span style="color:#e6db74">&#39;rate&#39;</span>: <span style="color:#e6db74">&#39;sum&#39;</span>,
</span></span><span style="display:flex;"><span>           <span style="color:#e6db74">&#39;nrate&#39;</span>: <span style="color:#e6db74">&#39;sum&#39;</span>
</span></span><span style="display:flex;"><span>           })
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>(df<span style="color:#f92672">.</span>T<span style="color:#f92672">.</span>to_dict()<span style="color:#f92672">.</span>values() )</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-18" class="outline-2">
<h2 id="headline-18">
Log
</h2>
<div id="outline-text-headline-18" class="outline-text-2">
<p>CLOCK: [2017-12-01 Fri 23:42]–[2017-12-01 Fri 23:48] =&gt;  0:06
  CLOCK: [2017-12-01 Fri 18:36]–[2017-12-01 Fri 20:37] =&gt;  2:01
  CLOCK: [2017-11-30 Thu 21:36]–[2017-12-01 Fri 18:35] =&gt; 20:59</p>
<ul>
<li><span class="timestamp">&lt;2017-11-20 Mon&gt;</span> - color,grade+half,area model&lt;-&gt;view connected - 1h</li>
<li><span class="timestamp">&lt;2017-11-29 Wed&gt;</span> - python api (bottle+tinydb), ajax submit, list routes</li>
<li><span class="timestamp">&lt;2017-11-30 Thu&gt;</span> - highlight route on list click, reset input on submit</li>
<li><span class="timestamp">&lt;2017-12-01 Fri&gt;</span> - style, &#34;&#34; instead of null for selection, db summery routes</li>
<li><span class="timestamp">&lt;2017-12-02 Sat&gt;</span> - simpler interface, &#34;user&#34;</li>
<li><span class="timestamp">&lt;2017-12-05 Tue&gt;</span> - add green to colors, textbox for set_date</li>
</ul>
<div id="outline-container-headline-19" class="outline-4">
<h4 id="headline-19">
<span class="todo">DONE</span>
<span class="priority">[A]</span>
integrate summary with display
</h4>
<div id="outline-text-headline-19" class="outline-text-4">
<p>CLOCK: [2017-12-02 Sat 09:15]–[2017-12-02 Sat 09:47] =&gt;  0:32</p>
</div>
</div>
<div id="outline-container-headline-20" class="outline-4">
<h4 id="headline-20">
<span class="todo">TODO</span>
<span class="priority">[A]</span>
filter summary color/grade/area
</h4>
<div id="outline-text-headline-20" class="outline-text-4">
<p>CLOCK: [2017-12-02 Sat 10:30]–[2017-12-02 Sat 12:12] =&gt;  1:42
    CLOCK: [2017-12-02 Sat 09:57]–[2017-12-02 Sat 10:25] =&gt;  0:28</p>
<div id="outline-container-headline-21" class="outline-5">
<h5 id="headline-21">
<span class="todo">TODO</span>
<span class="priority">[B]</span>
set_date
</h5>
</div>
</div>
</div>
<div id="outline-container-headline-22" class="outline-4">
<h4 id="headline-22">
<span class="todo">TODO</span>
<span class="priority">[B]</span>
fix -1=&gt;&#34;B&#34; on span route list click
</h4>
</div>
<div id="outline-container-headline-23" class="outline-4">
<h4 id="headline-23">
<span class="todo">DONE</span>
<span class="priority">[B]</span>
user
</h4>
</div>
<div id="outline-container-headline-24" class="outline-4">
<h4 id="headline-24">
<span class="todo">TODO</span>
<span class="priority">[C]</span>
different locations
</h4>
</div>
<div id="outline-container-headline-25" class="outline-4">
<h4 id="headline-25">
<span class="todo">DONE</span>
location summary 
</h4>
</div>
<div id="outline-container-headline-26" class="outline-4">
<h4 id="headline-26">
<span class="todo">DONE</span>
add edit: notes, rate, name, setter
</h4>
</div>
<div id="outline-container-headline-27" class="outline-4">
<h4 id="headline-27">
<span class="todo">TODO</span>
<span class="priority">[C]</span>
remove routes/reset wall
</h4>
</div>
</div>
</div>

      
    </div>
</body>
</html>
