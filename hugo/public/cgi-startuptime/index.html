<!DOCTYPE html>
<html>
  <head>
    <title>cgi-bin and interpreter startup time</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <link rel="alternate" type="application/rss+xml" title="WFLOG RSS Feed" href="index.xml" />
    <link rel="shortcut icon" href="https://secure.gravatar.com/avatar/3fed911ae9175eaf6c4e4ec51de7e6ac?size=125">
  </head>
  <body style="max-width: 40em">

    <h1 style="font-size:bigger">cgi-bin and interpreter startup time</h1>
    <div class="content">
      
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Numbers
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>
Motivated by generating an intuition for the bare minimum time a cgi-bin script request could take,
I&#39;ve generated an unprincipled list of startup times for various interpreters.</p>
<p>
There are lots of reasons to find this metric useless. It&#39;s nothing like a measure of how fast code can run in the interpreter (arithmetic, regexp matching, etc), or even the time needed to load in common dependencies.</p>
<p>
Eye-balling start up times for what I have installed on my system, there are 3 groups.</p>
<ul>
<li>fast (&lt;.005s): perl, awk, sed, bash, lisp(!)</li>
<li>okay: php, bb, py, node, ruby</li>
<li>slow (&gt;1s): julia, lisp, R, clojure</li>
</ul>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    <span style="color:#75715e"># hi in various interpreters </span>
</span></span><span style="display:flex;"><span>    hi_lisp<span style="color:#f92672">(){</span> sbcl --no-sysinit --no-userinit --eval <span style="color:#e6db74">&#39;(progn (format t &#34;hi!&#34;) (quit))&#39;</span>;<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># loads quicklisp</span>
</span></span><span style="display:flex;"><span>    hi_lpslow<span style="color:#f92672">(){</span> sbcl --eval <span style="color:#e6db74">&#39;(progn (format t &#34;hi!&#34;) (quit))&#39;</span>;<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    hi_pl<span style="color:#f92672">(){</span> perl -E <span style="color:#e6db74">&#34;say &#39;hi&#39;&#34;</span>;<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    hi_py<span style="color:#f92672">(){</span> python -c <span style="color:#e6db74">&#34;print(&#39;hi&#39;)&#34;</span>;<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    hi_node<span style="color:#f92672">(){</span> node -e <span style="color:#e6db74">&#34;console.log(&#39;hi&#39;)&#34;</span>;<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    hi_ruby<span style="color:#f92672">(){</span> ruby -e <span style="color:#e6db74">&#34;puts &#39;hi&#39;&#34;</span>;<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    hi_bb<span style="color:#f92672">(){</span> bb <span style="color:#e6db74">&#39;(print &#34;hi\n&#34;)&#39;</span>; <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    hi_bash<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> bash -c <span style="color:#e6db74">&#34;echo hi&#34;</span>;<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    hi_php<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> php -r <span style="color:#e6db74">&#39;echo &#34;hi\n&#34;;&#39;</span>;<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    hi_r<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> Rscript --vanilla -e <span style="color:#e6db74">&#34;print(&#39;hi&#39;)&#34;</span>;<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    hi_jl<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> julia -e <span style="color:#e6db74">&#39;print(&#34;hi&#34;)&#39;</span>;<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    hi_clj<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> clj --eval <span style="color:#e6db74">&#39;(println &#34;hi&#34;)&#39;</span>;<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    hi_apl<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> echo -e <span style="color:#e6db74">&#39;&#34;hi&#34;\n)OFF&#39;</span> |  apl --noCIN -q --noSV; <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    hi_awk<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> echo hi | awk <span style="color:#e6db74">&#39;{print $0}&#39;</span>;<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    hi_sed<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> echo hi | sed -n p;<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># time it. find all hi* functions. export them so hyperfine can see &#39;em</span>
</span></span><span style="display:flex;"><span>    csvtime<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> hyperfine $1 --style none --export-csv &gt;<span style="color:#f92672">(</span>cat<span style="color:#f92672">)</span> 2&gt;/dev/null ; <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> f in <span style="color:#66d9ef">$(</span>typeset -F|grep -oP <span style="color:#e6db74">&#39;hi_[a-z]+$&#39;</span><span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>      export -f $f
</span></span><span style="display:flex;"><span>      csvtime $f;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">done</span> |
</span></span><span style="display:flex;"><span>  sort -u | <span style="color:#75715e"># remove repeated headers. &#34;command&#34; sorted before &#34;hi*&#34; =&gt; header on top</span>
</span></span><span style="display:flex;"><span>  perl -F, -slane <span style="color:#e6db74">&#39;print join &#34;\t&#34;, map {$_=/^[0-9]/?sprintf(&#34;%.5f&#34;,$_):$_} @F&#39;</span>| <span style="color:#75715e"># fewer sigfig for numbers</span>
</span></span><span style="display:flex;"><span>  awk <span style="color:#e6db74">&#39;NR&lt;2{print $0;next}{print $0|&#34;sort -k2,2&#34;}&#39;</span>| <span style="color:#75715e"># sort all but the header</span>
</span></span><span style="display:flex;"><span>  sed s/hi_// <span style="color:#75715e"># remove function name that helped identify in $(typeset -F)</span></span></span></code></pre></div>
</div>
<table>
<tbody>
<tr>
<td>command</td>
<td class="align-right">mean</td>
<td class="align-right">stddev</td>
<td class="align-right">median</td>
<td class="align-right">user</td>
<td class="align-right">system</td>
<td class="align-right">min</td>
<td class="align-right">max</td>
</tr>
<tr>
<td>sed</td>
<td class="align-right">0.00233</td>
<td class="align-right">0.00025</td>
<td class="align-right">0.00228</td>
<td class="align-right">0.00182</td>
<td class="align-right">0.00114</td>
<td class="align-right">0.00189</td>
<td class="align-right">0.00389</td>
</tr>
<tr>
<td>pl</td>
<td class="align-right">0.00281</td>
<td class="align-right">0.00014</td>
<td class="align-right">0.0028</td>
<td class="align-right">0.00145</td>
<td class="align-right">0.00142</td>
<td class="align-right">0.00242</td>
<td class="align-right">0.00377</td>
</tr>
<tr>
<td>bash</td>
<td class="align-right">0.00338</td>
<td class="align-right">0.00014</td>
<td class="align-right">0.00338</td>
<td class="align-right">0.00213</td>
<td class="align-right">0.00134</td>
<td class="align-right">0.00297</td>
<td class="align-right">0.00436</td>
</tr>
<tr>
<td>awk</td>
<td class="align-right">0.00389</td>
<td class="align-right">0.00015</td>
<td class="align-right">0.00389</td>
<td class="align-right">0.00283</td>
<td class="align-right">0.00146</td>
<td class="align-right">0.0034</td>
<td class="align-right">0.00491</td>
</tr>
<tr>
<td>lisp</td>
<td class="align-right">0.00463</td>
<td class="align-right">0.00026</td>
<td class="align-right">0.00463</td>
<td class="align-right">0.00182</td>
<td class="align-right">0.0029</td>
<td class="align-right">0.00377</td>
<td class="align-right">0.00542</td>
</tr>
<tr>
<td>apl</td>
<td class="align-right">0.00737</td>
<td class="align-right">0.00026</td>
<td class="align-right">0.00738</td>
<td class="align-right">0.00417</td>
<td class="align-right">0.00354</td>
<td class="align-right">0.00671</td>
<td class="align-right">0.00883</td>
</tr>
<tr>
<td>php</td>
<td class="align-right">0.01478</td>
<td class="align-right">0.00029</td>
<td class="align-right">0.01475</td>
<td class="align-right">0.00838</td>
<td class="align-right">0.00623</td>
<td class="align-right">0.01423</td>
<td class="align-right">0.01664</td>
</tr>
<tr>
<td>bb</td>
<td class="align-right">0.02002</td>
<td class="align-right">0.00042</td>
<td class="align-right">0.01996</td>
<td class="align-right">0.00578</td>
<td class="align-right">0.01491</td>
<td class="align-right">0.01927</td>
<td class="align-right">0.02251</td>
</tr>
<tr>
<td>py</td>
<td class="align-right">0.02795</td>
<td class="align-right">0.00095</td>
<td class="align-right">0.02752</td>
<td class="align-right">0.02241</td>
<td class="align-right">0.00523</td>
<td class="align-right">0.02684</td>
<td class="align-right">0.03187</td>
</tr>
<tr>
<td>node</td>
<td class="align-right">0.03609</td>
<td class="align-right">0.0008</td>
<td class="align-right">0.03594</td>
<td class="align-right">0.02729</td>
<td class="align-right">0.00913</td>
<td class="align-right">0.03506</td>
<td class="align-right">0.04009</td>
</tr>
<tr>
<td>ruby</td>
<td class="align-right">0.06791</td>
<td class="align-right">0.00882</td>
<td class="align-right">0.06648</td>
<td class="align-right">0.05812</td>
<td class="align-right">0.00888</td>
<td class="align-right">0.0579</td>
<td class="align-right">0.08943</td>
</tr>
<tr>
<td>jl</td>
<td class="align-right">0.16368</td>
<td class="align-right">0.00241</td>
<td class="align-right">0.16342</td>
<td class="align-right">0.08349</td>
<td class="align-right">0.07878</td>
<td class="align-right">0.16008</td>
<td class="align-right">0.16821</td>
</tr>
<tr>
<td>r</td>
<td class="align-right">0.18803</td>
<td class="align-right">0.00371</td>
<td class="align-right">0.18716</td>
<td class="align-right">0.15006</td>
<td class="align-right">0.04015</td>
<td class="align-right">0.18374</td>
<td class="align-right">0.19786</td>
</tr>
<tr>
<td>lpslow</td>
<td class="align-right">0.33705</td>
<td class="align-right">0.00433</td>
<td class="align-right">0.336</td>
<td class="align-right">0.28454</td>
<td class="align-right">0.04951</td>
<td class="align-right">0.33246</td>
<td class="align-right">0.3469</td>
</tr>
<tr>
<td>clj</td>
<td class="align-right">1.07845</td>
<td class="align-right">0.02057</td>
<td class="align-right">1.07499</td>
<td class="align-right">1.57696</td>
<td class="align-right">0.21864</td>
<td class="align-right">1.05055</td>
<td class="align-right">1.11453</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
More on Motivation
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>Musings in <a href="https://eccentric-j.com/blog/clojure-like-its-php.html">https://eccentric-j.com/blog/clojure-like-its-php.html</a> consider
<code>babashka</code>&#39;s faster-than-clojure start up time in context of cgi-bin scripts. Aside: compiling clojure with GraalVM and serving quick starting binaries is an essential part of a <a href="https://github.com/LabNeuroCogDevel/psiclj">work project</a>.</p>
<p>
I find the babashka write-up compelling, but not for the same reason as the author. I have a very small collection of local cgi-bin scripts, all in bash. And all are under the magic 100-or-so lines that mark when convention says use a &#34;real programming language.&#34;</p>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> echo -e <span style="color:#e6db74">&#34;file\tline-count\ttype&#34;</span>
</span></span><span style="display:flex;"><span> ssh s2 <span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  for f in /srv/http/cgi-bin/*; do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   echo -e &#34;$(basename $f)\t$(wc -l &lt; $f)\t$(file -bL $f|sed s/,.*//)&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  done&#39;</span></span></span></code></pre></div>
</div>
<table>
<tbody>
<tr>
<td>file</td>
<td class="align-right">line-count</td>
<td>type</td>
</tr>
<tr>
<td>books</td>
<td class="align-right">46</td>
<td>Bourne-Again shell script</td>
</tr>
<tr>
<td>e</td>
<td class="align-right">48</td>
<td>Bourne-Again shell script</td>
</tr>
<tr>
<td>hi</td>
<td class="align-right">6</td>
<td>Bourne-Again shell script</td>
</tr>
<tr>
<td>tv</td>
<td class="align-right">73</td>
<td>Bourne-Again shell script</td>
</tr>
</tbody>
</table>
<p>
These utilities emerged organically from small itches and lean heavily on other bigger tools (calibre, sqlite, filesystem). Shell&#39;s a good fit, but the choice wasn&#39;t deliberate. It&#39;s nice to be prompted to think about it. The procrastinator-looking-for-an-escape is always interested in exploring other hacks.</p>
<p>
I&#39;d previously been burned by noticeably slow python. <code>Matplotlib</code> generated an image of the week&#39;s soccer roster to embed in emails for up-to-date whos-going-to-show-up status. It was slow enough that opening the google sheet in a new tab was often competitive time-wise. (Were I to redo the project, I&#39;d use shell and imagemagick)</p>
<p>
To that end, I&#39;m curious what the quickest start up is for common interpreters are.</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Other thoughts
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<div id="outline-container-headline-4" class="outline-3">
<h3 id="headline-4">
startup time is likely to be entirely eclipsed by library load times
</h3>
<div id="outline-text-headline-4" class="outline-text-3">
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>  hyperfine <span style="color:#e6db74">&#39;python -c &#34;1&#34;&#39;</span>
</span></span><span style="display:flex;"><span>  hyperfine <span style="color:#e6db74">&#39;python -c &#34;import matplotlib;import pandas; 1&#34;&#39;</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">)</span> |sed -n s/Range<span style="color:#f92672">[</span>^0-9<span style="color:#f92672">]</span>*//p</span></span></code></pre></div>
</div>
<pre class="example">
  25.8 ms …  27.6 ms    100 runs
  397.1 ms … 426.1 ms    10 runs
</pre>
</div>
</div>
<div id="outline-container-headline-5" class="outline-3">
<h3 id="headline-5">
Common lisp can start up fast if it doesn&#39;t have to load much
</h3>
<div id="outline-text-headline-5" class="outline-text-3">
<p>I haven&#39;t tested leaving out quicklisp but still loading whatever libraries would be useful. I suspect lisp would do better than python while still providing an interface to live edit.</p>
</div>
</div>
<div id="outline-container-headline-6" class="outline-3">
<h3 id="headline-6">
native binaries: fast but large
</h3>
<div id="outline-text-headline-6" class="outline-text-3">
<p>CL and clojure can both be compiled to very fast-starting native images. But both are large for even small programs (~60Mb for SBCL, and ~40Mb for clojure w/postgres at least)</p>
</div>
</div>
<div id="outline-container-headline-7" class="outline-3">
<h3 id="headline-7">
APL nerd snipe
</h3>
<div id="outline-text-headline-7" class="outline-text-3">
<p>I fell into a small APL rabbit hole. The online manual is wrong. Neither <a href="https://www.gnu.org/software/apl/apl.html"><code>--eval</code></a> nor <code>--off</code> are valid arguments! Regardless, anytime I come near APL, I loose hours thinking this will be the time it clicks. Doubly so when considering <a href="https://github.com/phantomics/april">april</a>. Someday I&#39;ll figure out getting a nifti file into lisp as a matrix and april will open up a new world. (20220404 edit: also <a href="https://github.com/shashi/APL.jl">APL.jl</a>)</p>
</div>
</div>
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
User experience 
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<blockquote>
<p>20ms feels fine, 50ms feels laggy, and 150ms feels unbearable.</p>
</blockquote>
<p>
   VR headset latency might be as orthogonal to application startup a time metric can get, but the psycho-physics still provide a useful baseline. With a shell terminal as a not-so-impoverished REPL for shell cgi-bin, the evaluate part of the loop is worth inspecting, though less so for the actual page rendering. Though there&#39;s psychology to explore there to. I wish APL had become an often embedded DSL as ubiquitous as regular expressions.</p>
<blockquote>
<p>Based on a 0.1s natural mobile site speed improvement, we … conversions increase [~8-10%]</p>
</blockquote>
<p>
   The same feels true for development, especially self-motivated ones. I&#39;ll move on to something with a quicker feedback if I am constantly waiting a second or two for iterative results.
<a href="https://input-delay.glitch.me/">https://input-delay.glitch.me/</a></p>
</div>
</div>
</div>
</div>

      
    </div>
</body>
</html>
