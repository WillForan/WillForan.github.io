<!DOCTYPE html>
<html>
  <head>
    <title>Netflix Usage</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <link rel="alternate" type="application/rss+xml" title="WFLOG RSS Feed" href="index.xml" />
    <link rel="shortcut icon" href="https://secure.gravatar.com/avatar/3fed911ae9175eaf6c4e4ec51de7e6ac?size=125">
  </head>
  <body style="max-width: 40em">

    <h1 style="font-size:bigger">Netflix Usage</h1>
    <div class="content">
      
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Viewing Activity
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>The &#34;viewing activity&#34; web interface is parsing json; no scraping needed!</p>
<p>
The actual data returned incluces a lot of useful information too.
Though it&#39;s not displayed, we have time-stamped view time, series title, and duration.</p>
<p>
It appears as though duration is <strong>not</strong> view duration but the duration of the episode/movie.
I think there is not a good way to see if something was only partially watched. This is inflating summary metrics.</p>
<div id="outline-container-headline-2" class="outline-3">
<h3 id="headline-2">
pulling data
</h3>
<div id="outline-text-headline-2" class="outline-text-3">
<ul>
<li><a href="https://www.netflix.com/WiViewingActivity">https://www.netflix.com/WiViewingActivity</a></li>
<li>inspect element -&gt; network console</li>
<li>ctrl + end (scroll to bottom to load)</li>
<li>
<p>right click -&gt; copy as curl</p>
<ul>
<li>increment ?pg= and can discard rest of url</li>
<li>only need memclid, SecureNetflixId, and NetflixId from Cookie</li>
<li>increasing page size seems to have no effect, always 100 items returned</li>
</ul>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span> ! -d netflix <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> mkdir netflix
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i in <span style="color:#f92672">{</span>1..10<span style="color:#f92672">}</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    curl <span style="color:#e6db74">&#34;https://www.netflix.com/api/shakti/adc049f7/viewingactivity?pg=</span>$i<span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        -H <span style="color:#e6db74">&#39;Cookie: memclid=XXXX; SecureNetflixId=XXX; NetflixId=XXXX&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        &gt; netflix/$i.json
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span></span></span></code></pre></div>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
Reading in
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<p>R has some nice tools to read in the data.</p>
<ul>
<li><code>jsonlite</code> creates a dataframe from a list of dicts automatically.</li>
<li><code>lubridate</code> makes working with dates easy</li>
</ul>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#a6e22e">library</span>(jsonlite)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">library</span>(lubridate)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">library</span>(dplyr)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">library</span>(cowplot)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  flist <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Sys.glob</span>(<span style="color:#e6db74">&#39;netflix/*json&#39;</span>)  
</span></span><span style="display:flex;"><span>  dlist <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">lapply</span>(flist, <span style="color:#a6e22e">function</span>(f) { <span style="color:#a6e22e">fromJSON</span>(f)<span style="color:#f92672">$</span>viewedItems } )
</span></span><span style="display:flex;"><span>  d <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Reduce</span>(rbind,dlist)
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># date column is *1000 unix epoch ==  dateStr</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># see: as.POSIXct(d$date/1000,origin=&#34;1970-01-01&#34;)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># get only this last year</span>
</span></span><span style="display:flex;"><span>  stopdate <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.numeric</span>(lubridate<span style="color:#f92672">::</span><span style="color:#a6e22e">now</span>() <span style="color:#f92672">-</span> <span style="color:#a6e22e">years</span>(<span style="color:#ae81ff">1</span>)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>  d.year <span style="color:#f92672">&lt;-</span>
</span></span><span style="display:flex;"><span>      d <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">filter</span>( date <span style="color:#f92672">&gt;=</span> stopdate)  <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">mutate</span>(datetime <span style="color:#f92672">=</span> <span style="color:#a6e22e">with_tz</span>(<span style="color:#a6e22e">as_datetime</span>(date<span style="color:#f92672">/</span><span style="color:#ae81ff">1000</span>),<span style="color:#e6db74">&#39;America/New_York&#39;</span>),
</span></span><span style="display:flex;"><span>             dur.min <span style="color:#f92672">=</span> duration<span style="color:#f92672">/</span><span style="color:#ae81ff">60</span> ) <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">filter</span>( dur.min <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>)  <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">arrange</span>(<span style="color:#f92672">-</span>date)</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
Summarizing 
</h2>
<div id="outline-text-headline-4" class="outline-text-2">
<p>Plotting what hour of the day gets the most TV watching and what series are viewed the most.</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  s <span style="color:#f92672">&lt;-</span>
</span></span><span style="display:flex;"><span>      d.year <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">group_by</span>(seriesTitle) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">summarise</span>(total.min<span style="color:#f92672">=</span><span style="color:#a6e22e">sum</span>(dur.min),
</span></span><span style="display:flex;"><span>                n <span style="color:#f92672">=</span> <span style="color:#a6e22e">n</span>(),
</span></span><span style="display:flex;"><span>                mindate <span style="color:#f92672">=</span> <span style="color:#a6e22e">min</span>(datetime),
</span></span><span style="display:flex;"><span>                maxdate <span style="color:#f92672">=</span> <span style="color:#a6e22e">max</span>(datetime)) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">mutate</span>(span.days <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.numeric</span>(maxdate<span style="color:#f92672">-</span>mindate)<span style="color:#f92672">/</span>(<span style="color:#ae81ff">60</span><span style="color:#f92672">*</span><span style="color:#ae81ff">60</span><span style="color:#f92672">*</span><span style="color:#ae81ff">24</span>),
</span></span><span style="display:flex;"><span>             rank<span style="color:#f92672">=</span><span style="color:#a6e22e">rank</span>(<span style="color:#f92672">-</span>n) ) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">arrange</span>(<span style="color:#f92672">-</span>n)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  p.topwatch <span style="color:#f92672">&lt;-</span>
</span></span><span style="display:flex;"><span>      s <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">filter</span>(total.min <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">500</span>) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">ggplot</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>n, y<span style="color:#f92672">=</span>span.days, color<span style="color:#f92672">=</span>total.min, label<span style="color:#f92672">=</span>seriesTitle) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#geom_point() +</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">geom_label</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">theme_bw</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">labs</span>(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;minutes\n watched&#34;</span>,
</span></span><span style="display:flex;"><span>           x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number episodes&#34;</span>,
</span></span><span style="display:flex;"><span>           y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;days between first and last watch&#34;</span>)
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>  p.hours <span style="color:#f92672">&lt;-</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">ggplot</span>(d.year) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">hour</span>(datetime),
</span></span><span style="display:flex;"><span>          fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">cut</span>(dur.min, breaks<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">30</span>,<span style="color:#ae81ff">60</span>,<span style="color:#ae81ff">90</span>,<span style="color:#66d9ef">Inf</span>))) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">geom_histogram</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">theme_bw</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">labs</span>(y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;freq&#39;</span>,
</span></span><span style="display:flex;"><span>           x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;hour of day&#39;</span>,
</span></span><span style="display:flex;"><span>           fill<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;show length&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plot_grid</span>(p.hours,p.topwatch,align<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;v&#39;</span>,nrow<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)</span></span></code></pre></div>
</div>
<p><img src="../images/netflix/summary.png" alt="../images/netflix/summary.png" title="../images/netflix/summary.png" /></p>
</div>
</div>

      
    </div>
</body>
</html>
